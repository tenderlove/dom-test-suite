<?xml version="1.0"?>
<!--
Copyright (c) 2001-2003 World Wide Web Consortium,
(Massachusetts Institute of Technology, Institut National de
Recherche en Informatique et en Automatique, Keio University). All
Rights Reserved. This program is distributed under the W3C's Software
Intellectual Property License. This program is distributed in the
hope that it will be useful, but WITHOUT ANY WARRANTY; without even
the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
PURPOSE.
See W3C License http://www.w3.org/Consortium/Legal/ for more details.
-->

<!--
$Log: build.xml,v $
Revision 1.107  2003-11-19 06:43:40  dom-ts-4
JSUnit 1.3.3 copied from wrong place (bug 350)

Revision 1.106  2003/11/18 08:36:32  dom-ts-4
DOMUserData does not appear in L3 schemas (bug 378)

Revision 1.105  2003/11/14 16:11:15  dom-ts-4
Preparations for automated builds/schema validation targets (bug 377)Eliminated requirement for Ant 1.6 or later when not schema validating

Revision 1.104  2003/11/12 06:59:02  dom-ts-4
Preparations for automated builds/schema validation targets (bug 377, phase 1)

Revision 1.101  2003/11/10 07:34:13  dom-ts-4
Update for 2003-11-07 CRs (bug 375)

Revision 1.100  2003/10/24 17:09:38  dom-ts-4
Support for working group drafts, bug 368

Revision 1.99  2003/09/23 03:44:21  dom-ts-4
Per http://www.w3.org/Bugs/Public/show_bug.cgi?id=345

Revision 1.98  2003/07/18 03:20:52  dom-ts-4
Bug 277: Schema validation fixups for DOM L3 Validation tests

Revision 1.97  2003/06/30 03:49:43  dom-ts-4
L2 Core schema invalid tests: http://www.w3.org/Bugs/Public/show_bug.cgi?id=260

Revision 1.96  2003/06/28 19:35:59  dom-ts-4
SAXON fails to build dom1-interfaces.xml: http://www.w3.org/Bugs/Public/show_bug.cgi?id=252

Revision 1.95  2003/06/11 03:20:17  dom-ts-4
Updated for the 09 June 2003 L3 Core Working Draft

Revision 1.94  2003/05/21 05:00:32  dom-ts-4
Add skeletal DOM 3 Core test suite
http://www.w3.org/Bugs/Public/show_bug.cgi?id=211

Revision 1.93  2003/04/24 05:02:05  dom-ts-4
Xalan-J support for L3 XPath
http://www.w3.org/Bugs/Public/show_bug.cgi?id=191

Revision 1.92  2003/04/23 04:49:19  dom-ts-4
Restore SVG plugin support
http://www.w3.org/Bugs/Public/show_bug.cgi?id=205

Revision 1.91  2003/04/17 04:22:01  dom-ts-4
Fixing schema validation problems with initial XPath submission
Bug #186: http://www.w3.org/Bugs/Public/show_bug.cgi?id=186

Revision 1.90  2003/04/09 21:15:18  plehegar
Added rules for DOM Level 3 XPath (Java and JSUnit)
Updated references to DOM Level 3 XPath and DOM Level 3 Events

Revision 1.89  2003/03/14 07:25:13  dom-ts-4
Split test suite code into DOMTestSuite.js

Revision 1.88  2003/02/28 07:42:06  dom-ts-4
Update for 2003-02-26 L3 Working Drafts

Revision 1.87  2003/02/12 21:57:52  plehegar
Added
xmlspec-v22-dom-available
and
get-xmlspec-v22-dom-dtd

Revision 1.86  2003/02/12 06:25:20  dom-ts-4
Typo resulting in buildecmascript directory
Missing  unzips for jsunit.zip in some -gen-jsunits

Revision 1.85  2003/02/10 07:08:12  dom-ts-4
Change to JSUnit 1.3.3

Revision 1.84  2003/02/06 05:58:30  dom-ts-4
Updated for DOM 3 Val 02/05 working draft

Revision 1.83  2003/01/28 06:07:45  dom-ts-4
Added dependency on dom2-init to dom3-interfaces (needs DOM 2 Traversal/Range)

Revision 1.82  2003/01/25 18:00:03  dom-ts-4
Added checkstyle tasks
Eliminated use of pregenerated tests

Revision 1.81  2003/01/21 16:11:57  dom-ts-4
Patched L2 HTML and L3 Val xml-source.xml to get xmlspec.dtd locally
Fixed encoding declaration of L2 HTML

Revision 1.80  2003/01/20 06:19:15  dom-ts-4
Removed Element.getElementsByTagName patch tasks (now done by XSLT)

Revision 1.79  2003/01/17 06:48:58  dom-ts-4
Added convienience targets for one shot LS test code generation
Added dom3-ls-validate-tests target, requires more work on DTD

Revision 1.78  2003/01/16 06:37:39  dom-ts-4
Update for DOM 2 HTML REC, new LS draft

Revision 1.77  2002/11/26 20:17:00  plehegar
Fixed dom2-html-matrix.
 The value of param must be inside the expression attribute, and no
inside its content.

Revision 1.76  2002/11/25 21:08:22  plehegar
Link the DOM Level 2 HTML PR draft instead of CR draft.

Revision 1.75  2002/11/06 12:27:51  dom-ts-5
Update for DOM Level 2 HTML CR
xml-source.xml replaces dom-spec.xml in the DOM2-HTML.zip file

Revision 1.74  2002/09/20 05:05:01  dom-ts-4
Eliminated calls to SED (well except for SVG)

Revision 1.73  2002/09/20 04:19:00  dom-ts-4
Fix for dom2-html-matrix task

Revision 1.72  2002/09/18 05:22:52  dom-ts-4
Added dom2-html-dist task, matrix and other supporting tasks

Revision 1.71  2002/08/23 05:10:07  dom-ts-4
HTMLApplet11 fixes

Revision 1.70  2002/08/23 04:00:56  dom-ts-4
Copied xhtml.dtd and DOMTSApplet.class to DOM L2 HTML JsUnit build

Revision 1.69  2002/08/13 05:20:37  dom-ts-4
Commented out inclusion of tests/level3/ls/files in dom3-ls.jar until there are some l3 test files

Revision 1.68  2002/08/13 04:51:34  dom-ts-4
Added dom3-ls-jar

Revision 1.67  2002/08/12 07:57:40  dom-ts-4
Sample LS test from Jeroen

Revision 1.66  2002/07/31 04:58:38  dom-ts-4
Update for July DOM 3 drafts

Revision 1.65  2002/06/29 19:13:33  dom-ts-4
Bad copy task

Revision 1.64  2002/06/29 18:40:01  dom-ts-4
Added dom1-[core|html]-validate-files and DOMTSApplet

Revision 1.63  2002/06/25 06:59:26  dom-ts-4
Added dom1-html-gen-jsunit, other cleanup

Revision 1.62  2002/06/10 04:24:01  dom-ts-4
Added XHTML DTD to dom1-core.jar

Revision 1.61  2002/06/06 05:04:11  dom-ts-4
Update for DOM Level 2 HTML CR
Added dom2-html-jar target

Revision 1.60  2002/06/03 23:56:13  dom-ts-4
Added dom2-events-jar and related tasks

Revision 1.59  2002/05/23 13:35:35  dom-ts-4
Changed depenencies for -validate-tests tasks

Revision 1.58  2002/04/21 23:13:30  dom-ts-4
Update for April 2002 L3 public working drafts

Revision 1.57  2002/04/19 05:17:42  dom-ts-4
Updated for 04/09 DOM 3 working drafts

Revision 1.56  2002/04/09 01:30:38  dom-ts-4
dom1-core-metadata didn't declare dependence on dom1-dtd
updated URL for new XPath WD

Revision 1.55  2002/03/27 07:40:15  dom-ts-4
dom3-schema builds "almost" final schema

Revision 1.54  2002/03/04 14:17:13  dom-ts-4
Added dom1-core-gen-browser that builds (currently non-functional)
HTML test runner

Revision 1.53  2002/03/02 22:55:09  dom-ts-4
Added dom1-html-matrix

Revision 1.52  2002/03/02 08:27:27  dom-ts-4
Added dom1-html-jar to build DOM1 HTML jar, more DOM L1 HTML to come

Revision 1.51  2002/03/01 08:12:34  dom-ts-4
Added dom2-core-matrix back into dom2-core-dist

Revision 1.50  2002/03/01 07:29:42  dom-ts-4
DOM L2 Distribution runnable (at least with SAXON)

Revision 1.49  2002/02/28 06:52:48  dom-ts-4
Added dom2-core-dist

Revision 1.48  2002/02/26 07:18:21  dom-ts-4
Copy test-to-html.xsl to distribution tests directory

Revision 1.47  2002/02/22 10:15:55  dom-ts-4
Changed build directory for DOM L2 Core and HTML JSUnit tests to match DOM L1 Core

Revision 1.46  2002/02/13 16:26:16  dom-ts-4
Updated for move of doxygen config files to doxygen, svgfix.sed to patches

Revision 1.45  2002/02/13 08:32:31  dom-ts-4
Copied jsunit/images and jsunit/tests to distribution

Revision 1.44  2002/02/13 08:01:15  dom-ts-4
Added dom1-core-dist target
Relocated .jar files from dist/ to build/
Patches JSUnit 1.2.6

Revision 1.43  2002/01/29 06:27:11  dom-ts-4
Changed tr/2001 to tr/2002 for new working drafts

Revision 1.42  2002/01/29 06:21:44  dom-ts-4
Moved patch files

Revision 1.41  2002/01/04 07:59:14  dom-ts-4
Added dom2-html-gen-java, dom2-html-javac targets

Revision 1.40  2001/12/10 17:15:20  dom-ts-4
URL for DOM Level 2 HTML updated

Revision 1.39  2001/12/10 05:37:20  dom-ts-4
Added xml_alltests, svg_alltests, and html_alltests suites to run all tests
using a particular content type.

Revision 1.38  2001/11/28 15:26:53  dom-ts-4
Copied dom2.dtd to tests/level2/html directory

Revision 1.37  2001/11/27 19:42:27  dom-ts-2
Added targets for dom2-html.


Revision 1.36  2001/11/17 04:28:15  dom-ts-4
Added dom2-core-gen-jsunit target

Revision 1.35  2001/11/16 05:46:09  dom-ts-4
Set debug="on" for java compilation.  Puts line numbers in tracebacks

Revision 1.34  2001/11/14 08:47:46  dom-ts-4
Added pre-generated documentcreatecdatasection.js and .html to
avoid Xalan-J lock ups with some versions

Revision 1.33  2001/11/14 02:08:36  dom-ts-4
Added pre-generated copy of documentcreatecdatasection.java
to avoid lockups with some versions of Xalan-J

Revision 1.32  2001/11/07 06:25:28  dom-ts-4
DOM Level 3 DTD and Schema building

Revision 1.31  2001/11/01 16:41:05  dom-ts-4
Added dom2-core-doxygen, updated usage

Revision 1.30  2001/11/01 15:02:50  dom-ts-4
Doxygen and Avalon support

Revision 1.29  2001/10/30 06:03:39  dom-ts-4
Updated build.xml to use 26 Oct 2001 DOM Level 2 HTML Working Draft

Revision 1.28  2001/10/25 09:29:27  dom-ts-4
test-to-java updates for DOM L2

Revision 1.27  2001/10/18 14:21:59  dom-ts-4
Fixed regexp pattern for stringLiteral
Explicitly specified UTF-8 encoding for test-to-java.xsl, etc
Specified UTF8 encoding for javac

Revision 1.26  2001/10/18 07:58:17  dom-ts-4
assertURIEquals added
Can now run from dom1-core.jar

Revision 1.25  2001/09/14 06:55:35  dom-ts-4
Support for Adobe SVG Viewer (must uncomment code in DOMTestCase.js)

Revision 1.24  2001/09/06 02:35:19  dom-ts-4
Now supporting Mozilla 0.9.3

Revision 1.23  2001/09/06 02:00:04  dom-ts-4
Now supporting Mozilla 0.9.3

Revision 1.22  2001/09/05 17:33:42  dom-ts-4
IE5 support.

Revision 1.21  2001/09/05 16:41:04  dom-ts-4
Support for JsUnit and IE5.

Revision 1.20  2001/09/05 16:39:55  dom-ts-4
Support for JsUnit and IE5.

Revision 1.19  2001/08/30 08:30:17  dom-ts-4
Added metadata and Software licence (dropped in earlier processing) to test
Enhanced test-matrix.xsl

Revision 1.18  2001/08/24 08:28:00  dom-ts-4
Test matrix generation.  Some Node.setValue() tests

Revision 1.17  2001/08/23 08:01:49  dom-ts-4
Test fixups for ignoring whitespace, et al

Revision 1.16  2001/08/22 22:12:46  dom-ts-4
Now passing all tests with default settings

Revision 1.15  2001/08/22 01:46:10  dom-ts-4
Updated subjects based on filename analysis

Revision 1.14  2001/08/21 06:06:12  dom-ts-4
DOM 1 SE targets
Fixed cases that locked Xalan
org.w3c.domts.level1.core.alltests
DOM2 DTD/Schema

Revision 1.13  2001/08/20 06:56:35  dom-ts-4
Full compile (-2 files that lock up Xalan 2.1)

Revision 1.12  2001/08/19 20:51:19  dom-ts-4
Successful DTD validation

Revision 1.11  2001/08/15 04:44:03  dom-ts-4
Added dom1-gen-ecmascript target to build.xml
Minor fixes to test-to-java.xsl and test-to-ecmascript.xsl

Revision 1.10  2001/08/14 18:49:35  dom-ts-4
Changed location of resource files
Remove spurious required ID's from DTD
Added xmlns:xsi and xsi:schema location to DTD
Removed package and targetURI attributes from Schema/DTD

Revision 1.9  2001/08/10 18:53:25  dom-ts-3

Attempt to make indentation more consistent, and limit line length to about
80 characters, for those of us who still need to live in an 80-column world
(if only due to geek social convention).

This only changes whitespace, not content or structure.

Revision 1.8  2001/08/02 04:44:15  dom-ts-4
Adapter for Avalon test framework.

Revision 1.7  2001/07/23 04:52:20  dom-ts-4
Initial test running using JUnit.

Revision 1.6  2001/07/20 05:44:32  dom-ts-4
Initial SVG support.  multiply renamed mult,
All implementation conditions combined into implementationAttribute element

-->
<project default="usage" basedir=".">

<target name="usage">
	<echo message="common targets:"/>
    <echo message="usage                displays this message"/>
    <echo message="clean                deletes all generated files"/>
    <echo message="junit-run            builds JUnit adapter for DOM Tests for Java"/>
    <echo message="avalon-run           builds Avalon Testlet adapter for DOM tests"/>
    <echo message="dom1-core-jar        builds DOM Level 1 Core tests for Java"/>
    <echo message="dom1-schema          builds W3C XML Schema for DOM 1 tests"/>
    <echo message="dom1-core-matrix     builds test matrix for DOM Level 1 Core"/>
    <echo message="dom1-core-validate-tests"/>
    <echo message="                     validates DOM Level 1 Core tests against DTD"/>
    <echo message="dom1-core-gen-jsunit"/>
    <echo message="                     builds JSUnit adapters for DOM Level 1 Core"/>
    <echo message="dom1-core-doxygen    builds documentation for DOM Level 1 Core"/>
    <echo message="dom1-core-dist       builds distribution for DOM Level 1 Core"/>
    <echo message="dom2-core-*          Same as above but for DOM Level 2 Core"/>
    <echo message="dom2-html-*          Same as above but for DOM Level 2 Core"/>
	<echo message=""/>
</target>

<target name="init">
	<property name="specs.dir" value="./lib/specs"/>
	<property name="transforms.dir" value="./transforms"/>
	<property name="build.dir" value="./build"/>
	<property name="java.build.dir" value="./build/java"/>
	<property name="tests.dir" value="./tests"/>
	<property name="metadata.dir" value="./build/metadata"/>
	<property name="dist.dir" value="./dist"/>
	<property name="lib.dir" value="./lib"/>
	<!--  any jar that contains org.w3c.dom and javax.xml.parsers classes  -->
	<property name="jaxp.jar" value="d:/ant1.4/lib/xerces.jar"/>
	<mkdir dir="${build.dir}"/>
	<mkdir dir="${lib.dir}"/>
	<mkdir dir="${specs.dir}"/>
	<mkdir dir="${dist.dir}"/>
    <available property="junit-available" file="${lib.dir}/junit.zip"/>
    <available property="junit-license-available" file="${lib.dir}/junit-license.html"/>
    <available property="jsunit-available" file="${lib.dir}/jsunit.zip"/>
    <available property="avalon-available" file="${lib.dir}/avalon.zip"/>
    <available property="xhtml1-dtd-available" file="${lib.dir}/xhtml1-dtd/xhtml1-frameset.dtd"/>
</target>


<target name="get-xhtml1-dtd" depends="init" unless="xhtml1-dtd-available">
    <mkdir dir="${lib.dir}/xhtml1-dtd"/>
    <get src="http://www.w3.org/TR/xhtml1/DTD/xhtml1-frameset.dtd"
        dest="${lib.dir}/xhtml1-dtd/xhtml1-frameset.dtd"
        usetimestamp="yes"/>
    <get src="http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"
        dest="${lib.dir}/xhtml1-dtd/xhtml1-transitional.dtd"
        usetimestamp="yes"/>
    <get src="http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"
        dest="${lib.dir}/xhtml1-dtd/xhtml1-strict.dtd"
        usetimestamp="yes"/>
    <get src="http://www.w3.org/TR/xhtml1/DTD/xhtml-lat1.ent"
        dest="${lib.dir}/xhtml1-dtd/xhtml-lat1.ent"
        usetimestamp="yes"/>
    <get src="http://www.w3.org/TR/xhtml1/DTD/xhtml-symbol.ent"
        dest="${lib.dir}/xhtml1-dtd/xhtml-symbol.ent"
        usetimestamp="yes"/>
    <get src="http://www.w3.org/TR/xhtml1/DTD/xhtml-special.ent"
        dest="${lib.dir}/xhtml1-dtd/xhtml-special.ent"
        usetimestamp="yes"/>
</target>

<!--  determines if DOM 1 spec files are already available locally  -->
<target name="dom1-check-spec" depends="init">
    <available property="dom1-available" file="${specs.dir}/DOM.zip"/>
</target>

<!--  gets DOM 1 specs unless they are available locally   -->
<target name="get-dom1" depends="dom1-check-spec" unless="dom1-available">
	<mkdir dir="${specs.dir}"/>
	<mkdir dir="${specs.dir}/Level-1"/>
	<!--   download DOM 1 spec to specs directory   -->
	<get src="http://www.w3.org/TR/1998/REC-DOM-Level-1-19981001/DOM.zip"
	     dest="${specs.dir}/DOM.zip"
	     usetimestamp="yes"/>
</target>

<target name="dom1-init" depends="get-dom1">

	<unzip src="${specs.dir}/DOM.zip" dest="${specs.dir}/Level-1"/>
	<unzip src="${specs.dir}/Level-1/xml-source.zip" dest="${specs.dir}/Level-1"/>

    <!--  add missing xmlns:xlink attribute    -->
    <replace file="${specs.dir}/Level-1/xml/wd-dom.xml" token="&lt;spec&gt;"
        value="&lt;spec xmlns:xlink='http://www.w3.org/1999/xlink'&gt;"/>
</target>

<target name="dom1-schema" depends="dom1-interfaces">
	<style basedir="${specs.dir}/Level-1/xml"
	       in="${build.dir}/dom1-interfaces.xml"
	       out="${build.dir}/dom1.xsd"
	       style="${transforms.dir}/dom-to-xsd.xsl">
		<param name="schema-namespace"
		   expression="http://www.w3.org/2001/DOM-Test-Suite/Level-1"/>
	</style>

	<!--  remove leading underscore from _xmlns attribute    -->
    <replace dir="${build.dir}" includes="dom1.xsd">
        <replacefilter token="_xmlns" value="xmlns"/>
        <replacefilter token="xmlns_test" value="xmlns:test"/>
    </replace>

	<copy file="${build.dir}/dom1.xsd" todir="${tests.dir}/level1/core"/>
	<copy file="${build.dir}/dom1.xsd" todir="${tests.dir}/level1/html"/>

	<!-- xmlvalidate file="${build.dir}/dom1.xsd" lenient="no"
	     failonerror="yes"
	     classname="org.apache.xerces.parsers.SAXParser"/ -->
</target>

<target name="dom1-dtd" depends="dom1-interfaces">
	<style basedir="${specs.dir}/Level-1/xml"
	       in="${build.dir}/dom1-interfaces.xml"
	       out="${build.dir}/dom1.dtd"
	       style="${transforms.dir}/dom-to-dtd.xsl">
		<param name="schema-namespace"
		   expression="http://www.w3.org/2001/DOM-Test-Suite/Level-1"/>
		<param name="schema-location" expression="dom1.xsd"/>
	</style>
	<copy file="${build.dir}/dom1.dtd" todir="${tests.dir}/level1/core"/>
	<copy file="${build.dir}/dom1.dtd" todir="${tests.dir}/level1/html"/>
    <copy file="${build.dir}/dom1.dtd" todir="${tests.dir}/submittedtests/netscapeHTML"/>
</target>

<target name="dom1-subjects" depends="dom1-init">
	<style basedir="${specs.dir}/Level-1/xml"
	       in="${specs.dir}/Level-1/xml/wd-dom.xml"
	       out="${build.dir}/dom1-subjects.xml"
	       style="${transforms.dir}/subjects.xsl"/>
</target>

<target name="dom1-core-metadata" depends="dom1-dtd">
    <mkdir dir="${build.dir}"/>
	<style in="${tests.dir}/level1/core/alltests.xml" 
		   out="${build.dir}/dom1-core-metadata.rdf" 
	       style="${transforms.dir}/combine-metadata.xsl">
		<param name="baseURI"
		       expression="http://www.w3.org/2001/DOM-Test-Suite/level1/core/"/>
        <param name="externalMetadata" expression="metadata.xml"/>
	</style>
</target>


<target name="dom1-core-matrix" depends="dom1-core-metadata,dom1-subjects,dom1-interfaces">
    <mkdir dir="${build.dir}"/>
	<style in="${build.dir}/dom1-core-metadata.rdf" 
		   out="${build.dir}/dom1-core-matrix.html" 
	       style="${transforms.dir}/test-matrix.xsl">
		<param name="specURI"
		       expression="http://www.w3.org/TR/1998/REC-DOM-Level-1-19981001/level-one-core#"/>
        <param name="interfacesURL" expression="dom1-interfaces.xml"/>
        <param name="specMetadataURL" expression="dom1-subjects.xml"/>
	</style>
</target>

<target name="dom1-html-metadata" depends="dom1-dtd">
    <mkdir dir="${build.dir}"/>
	<style in="${tests.dir}/level1/html/alltests.xml" 
		   out="${build.dir}/dom1-html-metadata.rdf" 
	       style="${transforms.dir}/combine-metadata.xsl">
		<param name="baseURI"
		       expression="http://www.w3.org/2001/DOM-Test-Suite/level1/html/"/>
        <param name="externalMetadata" expression="metadata.xml"/>
	</style>
</target>


<target name="dom1-html-matrix" depends="dom1-html-metadata,dom1-subjects,dom1-interfaces">
    <mkdir dir="${build.dir}"/>
	<style in="${build.dir}/dom1-html-metadata.rdf" 
		   out="${build.dir}/dom1-html-matrix.html" 
	       style="${transforms.dir}/test-matrix.xsl">
		<param name="specURI"
		       expression="http://www.w3.org/TR/1998/REC-DOM-Level-1-19981001/level-one-html#"/>
        <param name="interfacesURL" expression="dom1-interfaces.xml"/>
        <param name="specMetadataURL" expression="dom1-subjects.xml"/>
        <param name="title" expression="DOM Level 1 HTML Test Suite Matrix"/>
	</style>
</target>

<target name="analyze-names" depends="dom1-interfaces">
    <mkdir dir="${build.dir}/java/org/w3c/domts/level1/core"/>
	<style basedir="${tests.dir}/level1/core" 
		   destdir="${java.build.dir}/org/w3c/domts/level1/core" 
		   includes="*.xml" 
	       style="${transforms.dir}/check-subjects.xsl" 
	       extension=".xml">
		<param name="interfaces-docname"
		       expression="../${build.dir}/dom1-interfaces.xml"/>
		<param name="package"
		       expression="org.w3c.domts.level1.core"/>
		<param name="target-uri-base"
		       expression="http://www.w3.org/2001/DOM-Test-Suite/level1/core/"/>
	</style>
</target>

<!--  Saxon 6.5.2 has a problem with relative URL's in entity references
         and fails to produce this document, so if available
         a copy from the lib is used     -->
<target name="dom1-interfaces-init" depends="dom1-init">
    <available file="patches/dom1-interfaces.xml" property="dom1-interfaces-available"/>
</target>

<target name="dom1-interfaces-gen" depends="dom1-interfaces-init" unless="dom1-interfaces-available">
	<style basedir="${specs.dir}/Level-1/xml"
	       in="${specs.dir}/Level-1/xml/wd-dom.xml"
	       out="${build.dir}/dom1-interfaces.xml"
	       style="${transforms.dir}/dom1-errata.xsl"/>
</target>

<target name="dom1-interfaces-copy" depends="dom1-interfaces-init" if="dom1-interfaces-available">
    <copy todir="${build.dir}" file="patches/dom1-interfaces.xml"/>
</target>

<target name="dom1-interfaces" depends="dom1-interfaces-gen, dom1-interfaces-copy">
</target>

<target name="dom1-core-dist" depends="dom1-core-jar,dom1-core-gen-jsunit,dom1-core-matrix,dom1-core-doxygen,junit-run,get-junit-license,dom1-schema">
    <mkdir dir="${build.dir}/level1/core/resources"/>
    <mkdir dir="${build.dir}/level1/core/java"/>
    <copy file="docs/level1/core/index.htm" todir="${build.dir}/level1/core"/>
    <copy todir="${build.dir}/level1/core/resources">
        <fileset dir="docs/level1/core/resources" excludes="*.bak"/>
    </copy>
    <copy file="${build.dir}/dom1-core.jar" todir="${build.dir}/level1/core/java"/>
    <copy file="${build.dir}/junit-run.jar" todir="${build.dir}/level1/core/java"/>
    <copy file="${lib.dir}/junit3.7/junit.jar" todir="${build.dir}/level1/core/java"/>
    <copy file="${lib.dir}/junit-license.html" todir="${build.dir}/level1/core/java"/>
    <copy file="${build.dir}/ecmascript/jsunit/testRunner.html" todir="${build.dir}/level1/core/ecmascript"/>
    <mkdir dir="${build.dir}/level1/core/ecmascript/app"/>
    <copy todir="${build.dir}/level1/core/ecmascript/app">
        <fileset dir="${lib.dir}/jsunit/app" excludes="*.bak"/>
    </copy>
    <mkdir dir="${build.dir}/level1/core/ecmascript/images"/>
    <copy todir="${build.dir}/level1/core/ecmascript/images">
        <fileset dir="${build.dir}/ecmascript/jsunit/images" excludes="*.bak"/>
    </copy>
    <mkdir dir="${build.dir}/level1/core/ecmascript/docs"/>
    <copy todir="${build.dir}/level1/core/ecmascript/docs">
        <fileset dir="${build.dir}/ecmascript/jsunit/docs" excludes="*.bak"/>
    </copy>
    <mkdir dir="${build.dir}/level1/core/ecmascript/jsunit-self-tests"/>
    <copy todir="${build.dir}/level1/core/ecmascript/jsunit-self-tests">
        <fileset dir="${build.dir}/ecmascript/jsunit/tests" excludes="*.bak"/>
    </copy>
    <copy file="${build.dir}/dom1-core-matrix.html" todir="${build.dir}/level1/core"/>


    <mkdir dir="${build.dir}/level1/core/tests/files"/>
    <copy todir="${build.dir}/level1/core/tests">
        <fileset dir="${tests.dir}/level1/core" includes="*.xml"/>
        <fileset dir="${build.dir}" includes="dom1.dtd"/>
        <fileset dir="${build.dir}" includes="dom1.xsd"/>
        <fileset dir="${transforms.dir}" includes="test-to-html.xsl"/>
    </copy>
    <copy todir="${build.dir}/level1/core/tests/files">
        <fileset dir="${tests.dir}/level1/core/files" excludes="*.bak"/>
    </copy>

    <mkdir dir="${dist.dir}"/>
    <zip  zipfile="${dist.dir}/dom1-core.zip" basedir="${build.dir}/level1/core"/>
    <tar tarfile="${dist.dir}/dom1-core.tar" basedir="${build.dir}/level1/core"/>
    <gzip src="${dist.dir}/dom1-core.tar" zipfile="${dist.dir}/dom1-core.tar.gz"/>
        
        
</target>

<target name="dom1-gump" depends="dom1-core-validate-tests, 
								  dom1-html-validate-tests,
								  dom1-core-schema-validate-tests, 
								  dom1-html-schema-validate-tests,								   
								  dom1-core-jar,
								  dom1-html-jar"/>



<target name="dom2-check-spec" depends="init">
    <available property="dom2-core-available" file="${specs.dir}/DOM2-Core.zip"/>
    <available property="dom2-views-available" file="${specs.dir}/DOM2-Views-Java-Binding.zip"/>
    <available property="dom2-events-available" file="${specs.dir}/DOM2-Events-Java-Binding.zip"/>
    <available property="dom2-style-available" file="${specs.dir}/DOM2-Style.zip"/>
    <available property="dom2-traversal-available" file="${specs.dir}/DOM2-Traversal-Range.zip"/>
    <available property="dom2-html-available" file="${specs.dir}/DOM2-HTML-Java-Binding.zip"/>
    <available property="xmlspec-v22-dom-available" file="${specs.dir}/pubtext/xmlspec-v22-dom.dtd"/>
</target>

<!--  gets DOM 2 Core spec unless it is available locally   -->
<target name="get-dom2-core" depends="dom2-check-spec" unless="dom2-core-available">
	<mkdir dir="${specs.dir}"/>
	<mkdir dir="${specs.dir}/Level-2"/>
	<get src="http://www.w3.org/TR/2000/REC-DOM-Level-2-Core-20001113/DOM2-Core.zip"
		dest="${specs.dir}/DOM2-Core.zip"
		usetimestamp="yes"/>
</target>

<target name="get-dom2-views" depends="dom2-check-spec" unless="dom2-views-available">
	<mkdir dir="${specs.dir}"/>
	<mkdir dir="${specs.dir}/Level-2"/>
	<get src="http://www.w3.org/TR/2000/REC-DOM-Level-2-Views-20001113/DOM2-Views.zip"
		dest="${specs.dir}/DOM2-Views.zip"
		usetimestamp="yes"/>

    <get src="http://www.w3.org/TR/2000/REC-DOM-Level-2-Views-20001113/java-binding.zip"
        dest="${specs.dir}/DOM2-Views-Java-Binding.zip"
        usetimestamp="yes"/>

</target>

<target name="get-dom2-events" depends="dom2-check-spec" unless="dom2-events-available">
	<mkdir dir="${specs.dir}"/>
	<mkdir dir="${specs.dir}/Level-2"/>
	<get src="http://www.w3.org/TR/2000/REC-DOM-Level-2-Events-20001113/DOM2-Events.zip"
		dest="${specs.dir}/DOM2-Events.zip"
		usetimestamp="yes"/>
    <get src="http://www.w3.org/TR/2000/REC-DOM-Level-2-Events-20001113/java-binding.zip"
        dest="${specs.dir}/DOM2-Events-Java-Binding.zip"
        usetimestamp="yes"/>
</target>

<target name="get-dom2-style" depends="dom2-check-spec" unless="dom2-style-available">
	<mkdir dir="${specs.dir}"/>
	<mkdir dir="${specs.dir}/Level-2"/>
	<get src="http://www.w3.org/TR/2000/REC-DOM-Level-2-Style-20001113/DOM2-Style.zip"
		dest="${specs.dir}/DOM2-Style.zip"
		usetimestamp="yes"/>
</target>


<target name="get-dom2-traversal" depends="dom2-check-spec" unless="dom2-traversal-available">
	<mkdir dir="${specs.dir}"/>
	<mkdir dir="${specs.dir}/Level-2"/>
	<get src="http://www.w3.org/TR/2000/REC-DOM-Level-2-Traversal-Range-20001113/DOM2-Traversal-Range.zip"
		dest="${specs.dir}/DOM2-Traversal-Range.zip"
		usetimestamp="yes"/>
</target>

<target name="get-dom2-html" depends="dom2-check-spec" unless="dom2-html-available">
	<mkdir dir="${specs.dir}/pubtext"/>
	<mkdir dir="${specs.dir}/Level-2"/>
	<get src="http://www.w3.org/TR/2003/REC-DOM-Level-2-HTML-20030109/DOM2-HTML.zip"
		dest="${specs.dir}/DOM2-HTML.zip"
		usetimestamp="yes"/>
    <get src="http://www.w3.org/TR/2003/REC-DOM-Level-2-HTML-20030109/java-binding.zip"
        dest="${specs.dir}/DOM2-HTML-Java-Binding.zip"
        usetimestamp="yes"/>
    <!-- get src="http://www.w3.org/2002/08/xmlspec-v22-dom.dtd"
        dest="${specs.dir}/pubtext/xmlspec-v22-dom.dtd"
        usetimestamp="yes"/ -->
</target>

<target name="get-xmlspec-v22-dom-dtd" unless="xmlspec-v22-dom-available">
	<mkdir dir="${specs.dir}"/>
	<mkdir dir="${specs.dir}/pubtext"/>
	<get src="http://www.w3.org/2002/08/xmlspec-v22-dom.dtd"
		dest="${specs.dir}/pubtext/xmlspec-v22-dom.dtd"
		usetimestamp="yes"/>
</target>

<target name="get-dom2" depends="get-dom2-core,get-dom2-events,get-xmlspec-v22-dom-dtd,get-dom2-html,get-dom2-views,get-dom2-traversal,get-dom2-style">
</target>

<target name="dom2-init" depends="get-dom2">

	<unzip src="${specs.dir}/DOM2-Core.zip"
	       dest="${specs.dir}/Level-2/Core"/>
	<!--  XML source has unusual ../../whatever paths,
	        must put in several layers deep to prevent writing out
			of build tree   -->
	<unzip src="${specs.dir}/Level-2/Core/xml-source.zip"
	       dest="${specs.dir}/Level-2/xml/core"/>


	<unzip src="${specs.dir}/DOM2-Views.zip"
	       dest="${specs.dir}/Level-2/Views"/>
	<!--  XML source has unusual ../../whatever paths,
	        must put in several layers deep to prevent writing out
			of build tree   -->
	<unzip src="${specs.dir}/Level-2/Views/xml-source.zip"
	       dest="${specs.dir}/Level-2/xml/views"/>



	<unzip src="${specs.dir}/DOM2-Events.zip"
	       dest="${specs.dir}/Level-2/Events"/>
	<!--  XML source has unusual ../../whatever paths,
	        must put in several layers deep to prevent writing out
			of build tree   -->
	<unzip src="${specs.dir}/Level-2/Events/xml-source.zip"
	       dest="${specs.dir}/Level-2/xml/events"/>


	<unzip src="${specs.dir}/DOM2-Style.zip"
	       dest="${specs.dir}/Level-2/Style"/>
	<!--  XML source has unusual ../../whatever paths,
	        must put in several layers deep to prevent writing out
			of build tree   -->
	<unzip src="${specs.dir}/Level-2/Style/xml-source.zip"
	       dest="${specs.dir}/Level-2/xml/style"/>


	<unzip src="${specs.dir}/DOM2-Traversal-Range.zip"
	       dest="${specs.dir}/Level-2/Traversal-Range"/>
	<!--  XML source has unusual ../../whatever paths,
	        must put in several layers deep to prevent writing out
			of build tree   -->
	<unzip src="${specs.dir}/Level-2/Traversal-Range/xml-source.zip"
	       dest="${specs.dir}/Level-2/xml/traversal-range"/>



	<unzip src="${specs.dir}/DOM2-HTML.zip"
	       dest="${specs.dir}/Level-2/HTML"/>
    <!--  xml-source.xml had bad encoding declaration  -->
    <replace file="${specs.dir}/Level-2/HTML/xml-source.xml">
        <replacefilter token='encoding="us-ascii"'
        value='encoding="ISO-8859-1"'/>
        <replacefilter token='http://www.w3.org/2002/08/xmlspec-v22-dom.dtd'
            value='../../../pubtext/xmlspec-v22-dom.dtd'/>
    </replace>

	<copy file="${specs.dir}/Level-2/HTML/xml-source.xml" tofile="${specs.dir}/Level-2/xml/html/dom-spec.xml"/>

	<!--  zip file is missing two support files   -->
	<echo file="${specs.dir}/Level-2/xml/options.xml"
	      message="&lt;?xml version='1.0' encoding='UTF-8'?&gt;"/>
	<echo file="${specs.dir}/Level-2/xml/status.xml"
	      message="&lt;?xml version='1.0'  encoding='UTF-8'?&gt;"/>


	<unzip src="${specs.dir}/DOM2-HTML-Java-Binding.zip"
	       dest="${specs.dir}/Level-2/HTML/java"/>
	<unzip src="${specs.dir}/DOM2-Events-Java-Binding.zip"
	       dest="${specs.dir}/Level-2/Events"/>
	<unzip src="${specs.dir}/DOM2-Views-Java-Binding.zip"
	       dest="${specs.dir}/Level-2/Views"/>

</target>

<target name="dom2-schema" depends="dom2-interfaces">
	<style in="${build.dir}/dom2-interfaces.xml"
	       out="${build.dir}/dom2.xsd"
	       style="${transforms.dir}/dom-to-xsd.xsl">
		<param name="schema-namespace"
		   expression="http://www.w3.org/2001/DOM-Test-Suite/Level-2"/>
	</style>


    <replace dir="${build.dir}" includes="dom2.xsd">
        <replacefilter token="_xmlns" value="xmlns"/>
        <replacefilter token="xmlns_test" value="xmlns:test"/>
    </replace>
	<copy file="${build.dir}/dom2.xsd" todir="${tests.dir}/level2/core"/>
	<copy file="${build.dir}/dom2.xsd" todir="${tests.dir}/level2/html"/>
	<copy file="${build.dir}/dom2.xsd" todir="${tests.dir}/level2/events"/>
</target>

<target name="dom2-dtd" depends="dom2-interfaces">
	<style in="${build.dir}/dom2-interfaces.xml"
	       out="${build.dir}/dom2.dtd"
	       style="${transforms.dir}/dom-to-dtd.xsl">
		<param name="schema-namespace"
		   expression="http://www.w3.org/2001/DOM-Test-Suite/Level-2"/>
		<param name="schema-location" expression="dom2.xsd"/>
	</style>
	<copy file="${build.dir}/dom2.dtd" todir="${tests.dir}/level2/core"/>
	<copy file="${build.dir}/dom2.dtd" todir="${tests.dir}/level2/html"/>
	<copy file="${build.dir}/dom2.dtd" todir="${tests.dir}/level2/events"/>
</target>

<target name="dom2-subjects" depends="dom2-init">
	<!--  create a DOM 2 version of subjects.xsl  -->
	<style in="${specs.dir}/Level-2/xml/core/dom-spec.xml"
	       out="${build.dir}/dom2-core-subjects.xml"
	       style="${transforms.dir}/subjects.xsl">
           <param name="specURI" expression="http://www.w3.org/TR/DOM-Level-2-Core/core"/>
           <param name="specTitle" expression="Document Object Model (DOM) Level 2 Core Specification"/>
    </style>

	<style in="${specs.dir}/Level-2/xml/views/dom-spec.xml"
	       out="${build.dir}/dom2-views-subjects.xml"
	       style="${transforms.dir}/subjects.xsl">
           <param name="specURI" expression="http://www.w3.org/TR/DOM-Level-2-Views/views"/>
           <param name="specTitle" expression="Document Object Model (DOM) Level 2 Views Specification"/>
    </style>

	<style in="${specs.dir}/Level-2/xml/events/dom-spec.xml"
	       out="${build.dir}/dom2-events-subjects.xml"
	       style="${transforms.dir}/subjects.xsl">
           <param name="specURI" expression="http://www.w3.org/TR/DOM-Level-2-Events/events"/>
           <param name="specTitle" expression="Document Object Model (DOM) Level 2 Events Specification"/>
    </style>
    <!--
    Entities, probably defined in traversal-range/dom-spec.xml, not defined
	<style in="${specs.dir}/Level-2/xml/traversal-range/traversal.xml"
	       out="${build.dir}/dom2-traversal-subjects.xml"
	       style="${transforms.dir}/subjects.xsl">
           <param name="specURI" expression="http://www.w3.org/TR/DOM-Level-2-Traversal-Range/traversal"/>
           <param name="specTitle" expression="Document Object Model (DOM) Level 2 Traversal Specification
"/>
    </style>
	<style in="${specs.dir}/Level-2/xml/traversal-range/range.xml"
	       out="${build.dir}/dom2-range-subjects.xml"
	       style="${transforms.dir}/subjects.xsl">
           <param name="specURI" expression="http://www.w3.org/TR/DOM-Level-2-Traversal-Range/range"/>
           <param name="specTitle" expression="Document Object Model (DOM) Level 2 Range Specification
"/>
    </style>
    -->
	<style in="${specs.dir}/Level-2/xml/html/dom-spec.xml"
	       out="${build.dir}/dom2-html-subjects.xml"
	       style="${transforms.dir}/subjects.xsl">
           <param name="specURI" expression="http://www.w3.org/TR/DOM-Level-2-HTML/html"/>
           <param name="specTitle" expression="Document Object Model (DOM) Level 2 HTML Specification
"/>
    </style>
</target>



<target name="dom2-interfaces" depends="dom2-init">
    <!--    also changes Element.getElementsByTagName's
                name parameter to tagname    -->
	<style in="${specs.dir}/Level-2/xml/core/dom-spec.xml"
	       out="${build.dir}/dom2-interfaces.xml"
	       style="${transforms.dir}/dom2-combine.xsl"/>
	<xmlvalidate file="${build.dir}/dom2-interfaces.xml"
	             lenient="yes" failonerror="yes"
	             classname="org.apache.xerces.parsers.SAXParser"/>

	<style in="${specs.dir}/Level-2/xml/core/dom-spec.xml"
	       out="${build.dir}/dom2-core-interfaces.xml"
	       style="${transforms.dir}/extract.xsl"/>

</target>



<target name="dom1-core-validate-tests" depends="dom1-dtd">
	<xmlvalidate lenient="no" failonerror="yes"
	             classname="org.apache.xerces.parsers.SAXParser">
		<fileset dir="${tests.dir}/level1/core" includes="*.xml"/>  
	</xmlvalidate>
</target>

<target name="check-schema-support">
	<condition property="ant-15" value="true">
		<contains string="${ant.version}" substring="1.5"/>
	</condition>
	<fail if="ant-15" message="Schema validation requires Ant 1.6 or later."/>
</target>

<target name="dom1-core-schema-validate-tests" depends="check-schema-support, dom1-dtd, dom1-schema">
    <ant antfile="schemavalidate.ant">
    	<property name="validate.dir" location="${tests.dir}/level1/core"/>  
    </ant>
</target>


<target name="dom1-core-validate-files" depends="get-xhtml1-dtd">
    <copy todir="${tests.dir}/level1/core/files">
		<fileset dir="${lib.dir}/xhtml1-dtd"/>
    </copy>

	<xmlvalidate lenient="no" failonerror="yes"
	             classname="org.apache.xerces.parsers.SAXParser">
		<fileset dir="${tests.dir}/level1/core/files" includes="*.xml" excludes="nodtdstaff.xml"/>  
	</xmlvalidate>
</target>

<target name="dom1-core-gen-java" depends="dom1-interfaces, dom1-dtd">
    <mkdir dir="${build.dir}/java/org/w3c/domts/level1/core"/>



	<style basedir="${tests.dir}/level1/core" 
		   destdir="${java.build.dir}/org/w3c/domts/level1/core" 
		   includes="*.xml" 
           excludes="metadata.xml"
	       style="${transforms.dir}/test-to-java.xsl" 
	       extension=".java">
		<param name="interfaces-docname"
		       expression="../${build.dir}/dom1-interfaces.xml"/>
		<param name="package"
		       expression="org.w3c.domts.level1.core"/>
		<param name="target-uri-base"
		       expression="http://www.w3.org/2001/DOM-Test-Suite/level1/core/"/>
	</style>


</target>

<target name="dom1-html-validate-tests" depends="dom1-dtd">
	<xmlvalidate lenient="no" failonerror="yes"
	             classname="org.apache.xerces.parsers.SAXParser">
		<fileset dir="${tests.dir}/level1/html" includes="*.xml"/>  
        <fileset dir="${tests.dir}/submittedtests/netscapeHTML" includes="*.xml"/>
	</xmlvalidate>
</target>

<target name="dom1-html-schema-validate-tests" depends="check-schema-support, dom1-dtd, dom1-schema">
    <ant antfile="schemavalidate.ant">
    	<property name="validate.dir" location="${tests.dir}/level1/html"/>  
    </ant>
</target>



<target name="dom1-html-validate-files" depends="get-xhtml1-dtd">
    <copy todir="${tests.dir}/level1/html/files">
		<fileset dir="${lib.dir}/xhtml1-dtd"/>
    </copy>

	<xmlvalidate lenient="no" failonerror="yes"
	             classname="org.apache.xerces.parsers.SAXParser">
		<fileset dir="${tests.dir}/level1/html/files" includes="*.xml" excludes="nodtdstaff.xml"/>  
	</xmlvalidate>
</target>


<target name="dom1-html-gen-java" depends="dom1-interfaces,dom1-dtd">
    <mkdir dir="${build.dir}/java/org/w3c/domts/level1/html"/>
	<style basedir="${tests.dir}/level1/html" 
		   destdir="${java.build.dir}/org/w3c/domts/level1/html" 
		   includes="*.xml" 
           excludes="metadata.xml"
	       style="${transforms.dir}/test-to-java.xsl" 
	       extension=".java">
		<param name="interfaces-docname"
		       expression="../${build.dir}/dom1-interfaces.xml"/>
		<param name="package"
		       expression="org.w3c.domts.level1.html"/>
		<param name="target-uri-base"
		       expression="http://www.w3.org/2001/DOM-Test-Suite/level1/html/"/>
	</style>
	<style basedir="${tests.dir}/submittedtests/netscapeHTML" 
		   destdir="${java.build.dir}/org/w3c/domts/level1/html" 
		   includes="*.xml" 
           excludes="metadata.xml,xml_alltests.xml"
	       style="${transforms.dir}/test-to-java.xsl" 
	       extension=".java">
		<param name="interfaces-docname"
		       expression="../${build.dir}/dom1-interfaces.xml"/>
		<param name="package"
		       expression="org.w3c.domts.level1.html"/>
		<param name="target-uri-base"
		       expression="http://www.w3.org/2001/DOM-Test-Suite/level1/html/"/>
	</style>

</target>

<target name="dom1-html-javac" depends="common-javac,dom1-html-gen-java">
	<javac srcdir="${java.build.dir}/org/w3c/domts/level1/html" 
		destdir="${java.build.dir}" 
		classpath="${java.build.dir};${jaxp.jar}"
        debug="on"
		encoding="UTF8"/>
</target>

<target name="checkstyle-available">
    <available property="checkstyle-task" resource="checkstyletask.properties"/>
    <fail unless="checkstyle-task" message="Checkstyle targets require checkstyle-all-2.x.jar from http://checkstyle.sf.net to be in /ant/lib"/>        
</target>

<target name="dom1-html-checkstyle" depends="checkstyle-available, dom1-html-javac">
    <taskdef resource="checkstyletask.properties"/>

    <checkstyle>
        <fileset dir="${java.build.dir}/org/w3c/domts/level1/html" includes="*.java"/>

        <!-- Allow long lines  -->
        <property key="checkstyle.maxlinelen" value="1024"/>

        <!-- Allows wildcard imports -->
        <property key="checkstyle.ignore.imports" value="true"/>

        <!-- Allows test names that start with lowercase -->
        <property key="checkstyle.pattern.type" value="^[a-zA-Z][a-zA-Z0-9_]*$"/>

        <property key="checkstyle.maxmethodlen" value="5000"/>
    </checkstyle>

</target>


<target name="dom1-html-jar" depends="dom1-html-javac">
	<!--  will need to provide a manifest    -->
	<jar jarfile="${build.dir}/dom1-html.jar"  manifest="java/dom1-html.mf">
		<fileset dir="${java.build.dir}"
		         includes="org/w3c/domts/*" excludes="*.bak"/>
		<fileset dir="${java.build.dir}"
		         includes="org/w3c/domts/level1/html/*"
		         excludes="*.bak"/>
		<fileset dir="tests/level1/html/files" excludes="*.bak"/>
		<fileset dir="java"
		         includes="org/w3c/domts/*" excludes="*.bak"/>
	</jar>
</target>

<target name="dom1-html-gen-jsunit" depends="jsunit-get,dom1-interfaces,dom1-dtd,get-xhtml1-dtd">
    <mkdir dir="${build.dir}/ecmascript/level1/html/files"/>
	<copy todir="${build.dir}/ecmascript/level1/html">
        <fileset dir="ecmascript" includes="*.js"/>
    </copy>
    <copy todir="${build.dir}/ecmascript/level1/html/files">
		<fileset dir="tests/level1/html/files" excludes="*.bak"/>
    </copy>
    <!--  copy XHTML 1.0 DTD's to output directory   -->
    <copy todir="${build.dir}/ecmascript/level1/html">
		<fileset dir="${lib.dir}/xhtml1-dtd"/>
    </copy>
    <!--  copy simple Java 1.1 applet to satisfy applet test cases -->
    <mkdir dir="${build.dir}/ecmascript/level1/html/applets/org/w3c/domts"/>
    <copy todir="${build.dir}/ecmascript/level1/html/applets/org/w3c/domts">
        <fileset dir="java/applets/org/w3c/domts" includes="DOMTSApplet.class"/>
    </copy>
    <copy todir="${build.dir}/ecmascript/level1/html/applets">
        <fileset dir="java/applets" includes="DOMTSApplet.dat"/>
    </copy>
       

	<style basedir="${tests.dir}/level1/html" 
		   destdir="${build.dir}/ecmascript/level1/html" 
		   includes="*.xml" 
           excludes="metadata.xml"
	       style="${transforms.dir}/test-to-jsunit.xsl" 
	       extension=".html">
		<param name="interfaces-docname"
		       expression="../${build.dir}/dom1-interfaces.xml"/>
		<param name="target-uri-base"
		       expression="http://www.w3.org/2001/DOM-Test-Suite/level1/html/"/>
        <param name="testpath" expression="../level1/html/"/>
	</style>
</target>



<target name="jsunit-get" depends="init">
    <fail unless="jsunit-available" 
        message="download jsunit.zip from http://www.jsunit.net and place in lib directory"/>
    <unzip dest="${build.dir}/ecmascript" src="${lib.dir}/jsunit.zip"/>
    <replace file="${build.dir}/ecmascript/jsunit/app/jsUnitCore.js" 
        token="top.xbDEBUG.on &amp;&amp; top.testManager"
        value="top != null &amp;&amp; top.xbDEBUG != null &amp;&amp; top.xbDEBUG.on &amp;&amp; top.testManager"/>
    <replace file="${build.dir}/ecmascript/jsunit/app/jsUnitTestManager.js" 
        token="SETUPAGE_INTERVAL"
        value="SETUPPAGE_INTERVAL"/>
</target>


<target name="dom1-core-gen-jsunit" depends="jsunit-get,dom1-interfaces,dom1-dtd,get-xhtml1-dtd">
    <mkdir dir="${build.dir}/ecmascript/level1/core/files"/>
	<copy todir="${build.dir}/ecmascript/level1/core">
        <fileset dir="ecmascript" includes="*.js"/>
    </copy>
    <copy todir="${build.dir}/ecmascript/level1/core/files">
		<fileset dir="tests/level1/core/files" excludes="*.bak"/>
    </copy>
    <copy todir="${build.dir}/ecmascript/level1/core/files">
        <fileset dir="${lib.dir}/xhtml1-dtd"/>
    </copy>

	<style basedir="${tests.dir}/level1/core" 
		   destdir="${build.dir}/ecmascript/level1/core" 
		   includes="*.xml" 
           excludes="metadata.xml"
	       style="${transforms.dir}/test-to-jsunit.xsl" 
	       extension=".html">
		<param name="interfaces-docname"
		       expression="../${build.dir}/dom1-interfaces.xml"/>
		<param name="target-uri-base"
		       expression="http://www.w3.org/2001/DOM-Test-Suite/level1/core/"/>
        <param name="testpath" expression="../level1/core/"/>
	</style>
</target>



<target name="common-javac" depends="init">
	<mkdir dir="${java.build.dir}"/>
	<javac srcdir="java/org/w3c/domts" 
		   destdir="${java.build.dir}" 
		   classpath="${java.build.dir}"
           debug="on"
		   encoding="UTF8"/>
</target>

<target name="common-checkstyle" depends="checkstyle-available, common-javac">
    <taskdef resource="checkstyletask.properties"/>

    <checkstyle>
        <fileset dir="java/org/w3c/domts" includes="*.java"/>
    </checkstyle>

</target>


<target name="dom1-core-javac" depends="common-javac,dom1-core-gen-java">
	<javac srcdir="${java.build.dir}/org/w3c/domts/level1/core" 
		destdir="${java.build.dir}" 
		classpath="${java.build.dir};${jaxp.jar}"
        debug="on"
		encoding="UTF8"/>
</target>

<target name="dom1-core-checkstyle" depends="checkstyle-available, dom1-core-javac">
    <taskdef resource="checkstyletask.properties"/>

    <checkstyle>
        <fileset dir="${java.build.dir}/org/w3c/domts/level1/core" includes="*.java"/>

        <!-- Allow long lines  -->
        <property key="checkstyle.maxlinelen" value="1024"/>

        <!-- Allows wildcard imports -->
        <property key="checkstyle.ignore.imports" value="true"/>

        <!-- Allows test names that start with lowercase -->
        <property key="checkstyle.pattern.type" value="^[a-zA-Z][a-zA-Z0-9_]*$"/>

        <property key="checkstyle.maxmethodlen" value="5000"/>
    </checkstyle>

</target>

<target name="dom1-core-jar" depends="dom1-core-javac,get-xhtml1-dtd">
    
	<jar jarfile="${build.dir}/dom1-core.jar" manifest="java/dom1-core.mf">
		<fileset dir="${java.build.dir}"
		         includes="org/w3c/domts/*" excludes="*.bak"/>
		<fileset dir="${java.build.dir}"
		         includes="org/w3c/domts/level1/core/*"
		         excludes="*.bak"/>
		<fileset dir="tests/level1/core/files" excludes="*.bak"/>
		<fileset dir="java"
		         includes="org/w3c/domts/*" excludes="*.bak"/>
        <fileset dir="${lib.dir}/xhtml1-dtd"/>
	</jar>
</target>

<target name="dom1-core-javadoc" depends="dom1-core-gen-java">
    <mkdir dir="${build.dir}/javadoc"/>
    <javadoc packagenames="org.w3c.domts.*"
             sourcepath="java/org/w3c/domts/level1/core;java/junit;${lib.dir}/junit3.7/junit.jar;${lib.dir}/testlet.dir"
             destdir="${build.dir}/javadoc"
             author="true"
             version="true"
             use="true"
             windowtitle="DOM Test Suite"
             bottom="Copyright &#169; 2001 World Wide Web Consortium.">
             <group title="Test Suite Framework" packages="org.w3c.domts"/>
             <group title="DOM Level 1 Core" packages="org.w3c.domts.level1.core"/>
             <group title="DOM Level 2 Core" packages="org.w3c.domts.level2.core"/>
    </javadoc>
</target>

<target name="dom1-core-doxygen" depends="dom1-core-gen-java">
    <mkdir dir="${build.dir}/level1/core/doxygen"/>

    <!--  doxygen must be on path  
          download from http://www.doxygen.org    -->
    <exec executable="doxygen">
        <arg line="doxygen/dom1-core.doxygen"/>
    </exec>

</target>


<target name="dom2-core-validate-tests" depends="dom2-dtd">
	<xmlvalidate lenient="no" failonerror="yes"
	             classname="org.apache.xerces.parsers.SAXParser">
		<fileset dir="${tests.dir}/level2/core" includes="*.xml"/>  
	</xmlvalidate>
</target>

<target name="dom2-core-schema-validate-tests" depends="check-schema-support, dom2-dtd, dom2-schema">
    <ant antfile="schemavalidate.ant">
    	<property name="validate.dir" location="${tests.dir}/level2/core"/>  
    </ant>
</target>



<target name="dom2-html-validate-tests" depends="dom2-dtd">
	<xmlvalidate lenient="no" failonerror="yes"
	             classname="org.apache.xerces.parsers.SAXParser">
		<fileset dir="${tests.dir}/level2/html" includes="*.xml"/>  
	</xmlvalidate>
</target>

<target name="dom2-html-schema-validate-tests" depends="check-schema-support, dom2-dtd, dom2-schema">
    <ant antfile="schemavalidate.ant">
    	<property name="validate.dir" location="${tests.dir}/level2/html"/>  
    </ant>
</target>

<target name="dom2-events-validate-tests" depends="dom2-dtd">
	<xmlvalidate lenient="no" failonerror="yes"
	             classname="org.apache.xerces.parsers.SAXParser">
		<fileset dir="${tests.dir}/level2/events" includes="*.xml"/>  
	</xmlvalidate>
</target>

<target name="dom2-events-schema-validate-tests" depends="check-schema-support, dom2-dtd, dom2-schema">
    <ant antfile="schemavalidate.ant">
    	<property name="validate.dir" location="${tests.dir}/level2/events"/>  
    </ant>
</target>



<target name="dom2-core-gen-java" depends="dom2-interfaces,dom2-dtd">
    <mkdir dir="${build.dir}/java/org/w3c/domts/level2/core"/>


    <!--  a prefabricated importNode02.java and others
             are provided since some versions of Xalan-J
                   will stall when processing it    -->

<!--
    <copy file="${tests.dir}/level2/core/importNode02.java" 
            todir="${java.build.dir}/org/w3c/domts/level2/core"/>

    <copy file="${tests.dir}/level2/core/ownerDocument01.java" 
            todir="${java.build.dir}/org/w3c/domts/level2/core"/>

-->

	<style basedir="${tests.dir}/level2/core" 
		   destdir="${java.build.dir}/org/w3c/domts/level2/core" 
		   includes="*.xml" 
           excludes="metadata.xml"
	       style="${transforms.dir}/test-to-java.xsl" 
	       extension=".java">
		<param name="interfaces-docname"
		       expression="../${build.dir}/dom2-interfaces.xml"/>
		<param name="package"
		       expression="org.w3c.domts.level2.core"/>
		<param name="target-uri-base"
		       expression="http://www.w3.org/2001/DOM-Test-Suite/level2/core/"/>
	</style>
</target>


<target name="dom2-core-gen-jsunit" depends="jsunit-get,dom2-interfaces,dom2-dtd">
    <mkdir dir="${build.dir}/ecmascript/level2/core/files"/>
	<copy todir="${build.dir}/ecmascript/level2/core">
        <fileset dir="ecmascript" includes="*.js"/>
    </copy>
    <copy todir="${build.dir}/ecmascript/level2/core/files">
		<fileset dir="tests/level2/core/files" excludes="*.bak"/>
    </copy>

	<style basedir="${tests.dir}/level2/core" 
		   destdir="${build.dir}/ecmascript/level2/core" 
		   includes="*.xml" 
           excludes="metadata.xml"
	       style="${transforms.dir}/test-to-jsunit.xsl" 
	       extension=".html">
		<param name="interfaces-docname"
		       expression="../${build.dir}/dom2-interfaces.xml"/>
		<param name="target-uri-base"
		       expression="http://www.w3.org/2001/DOM-Test-Suite/level2/core/"/>
        <param name="testpath" expression="../level2/core/"/>
	</style>
</target>

<target name="dom2-html-gen-java" depends="dom2-interfaces,dom2-dtd">
    <mkdir dir="${build.dir}/java/org/w3c/domts/level2/html"/>
	<style basedir="${tests.dir}/level2/html" 
		   destdir="${java.build.dir}/org/w3c/domts/level2/html" 
		   includes="*.xml" 
           excludes="metadata.xml"
	       style="${transforms.dir}/test-to-java.xsl" 
	       extension=".java">
		<param name="interfaces-docname"
		       expression="../${build.dir}/dom2-interfaces.xml"/>
		<param name="package"
		       expression="org.w3c.domts.level2.html"/>
		<param name="target-uri-base"
		       expression="http://www.w3.org/2001/DOM-Test-Suite/level2/html/"/>
        <param name="import-html" expression="import org.w3c.dom.html2.*;"/>
	</style>
</target>


<target name="dom2-html-gen-jsunit" depends="jsunit-get,dom2-interfaces,dom2-dtd,get-xhtml1-dtd">
    <mkdir dir="${build.dir}/ecmascript/level2/html/files"/>
	<copy todir="${build.dir}/ecmascript/level2/html">
        <fileset dir="ecmascript" includes="*.js"/>
    </copy>
    <copy todir="${build.dir}/ecmascript/level2/html/files">
		<fileset dir="tests/level2/html/files" excludes="*.bak"/>
    </copy>

    <!--  copy XHTML 1.0 DTD's to output directory   -->
    <copy todir="${build.dir}/ecmascript/level2/html/files">
		<fileset dir="${lib.dir}/xhtml1-dtd"/>
    </copy>
    <!--  copy simple Java 1.1 applet to satisfy applet test cases -->
    <copy todir="${build.dir}/ecmascript/level2/html/applets/org/w3c/domts">
        <fileset dir="java/applets/org/w3c/domts" includes="DOMTSApplet.class"/>
    </copy>
    <copy todir="${build.dir}/ecmascript/level2/html/applets">
        <fileset dir="java/applets" includes="DOMTSApplet.dat"/>
    </copy>


	<style basedir="${tests.dir}/level2/html" 
		   destdir="${build.dir}/ecmascript/level2/html" 
		   includes="*.xml" 
           excludes="metadata.xml"
	       style="${transforms.dir}/test-to-jsunit.xsl" 
	       extension=".html">
		<param name="interfaces-docname"
		       expression="../${build.dir}/dom2-interfaces.xml"/>
		<param name="target-uri-base"
		       expression="http://www.w3.org/2001/DOM-Test-Suite/level2/html/"/>
        <param name="testpath" expression="../level2/html/"/>
	</style>
</target>

<target name="dom2-events-gen-java" depends="dom2-interfaces,dom2-dtd">
    <mkdir dir="${build.dir}/java/org/w3c/domts/level2/events"/>

	<style basedir="${tests.dir}/level2/events" 
		   destdir="${java.build.dir}/org/w3c/domts/level2/events" 
		   includes="*.xml" 
           excludes="metadata.xml"
	       style="${transforms.dir}/test-to-java.xsl" 
	       extension=".java">
		<param name="interfaces-docname"
		       expression="../${build.dir}/dom2-interfaces.xml"/>
		<param name="package"
		       expression="org.w3c.domts.level2.events"/>
		<param name="target-uri-base"
		       expression="http://www.w3.org/2001/DOM-Test-Suite/level2/events/"/>
	</style>
</target>


<target name="dom2-core-javac" depends="common-javac,dom2-core-gen-java">
	<javac srcdir="${java.build.dir}/org/w3c/domts/level2/core" 
		destdir="${java.build.dir}" 
		classpath="${java.build.dir};${jaxp.jar}"
        debug="on"
		encoding="UTF8"/>
</target>

<target name="dom2-core-checkstyle" depends="checkstyle-available, dom2-core-javac">
    <taskdef resource="checkstyletask.properties"/>

    <checkstyle>
        <fileset dir="${java.build.dir}/org/w3c/domts/level2/core" includes="*.java"/>

        <!-- Allow long lines  -->
        <property key="checkstyle.maxlinelen" value="1024"/>

        <!-- Allows wildcard imports -->
        <property key="checkstyle.ignore.imports" value="true"/>

        <!-- Allows test names that start with lowercase -->
        <property key="checkstyle.pattern.type" value="^[a-zA-Z][a-zA-Z0-9_]*$"/>

        <property key="checkstyle.pattern.localvar" value="^[a-zA-Z][a-zA-Z0-9_]*$"/>

        <property key="checkstyle.maxmethodlen" value="5000"/>
    </checkstyle>

</target>



<target name="dom2-html-javac" depends="common-javac, dom2-html-gen-java">
	<javac srcdir="${java.build.dir}/org/w3c/domts/level2/html" 
		destdir="${java.build.dir}" 
		classpath="${java.build.dir};${jaxp.jar}"
        debug="on"
		encoding="UTF8">  
        <src path="${java.build.dir}"/>
        <src path="${specs.dir}/Level-2/HTML/java"/>
        <include name="org/w3c/domts/*"/>
        <include name="org/w3c/domts/level2/html/*"/>
        <include name="org/w3c/dom/**"/>
    </javac>
</target>

<target name="dom2-html-checkstyle" depends="checkstyle-available, dom2-html-javac">
    <taskdef resource="checkstyletask.properties"/>

    <checkstyle>
        <fileset dir="${java.build.dir}/org/w3c/domts/level2/html" includes="*.java"/>

        <!-- Allow long lines  -->
        <property key="checkstyle.maxlinelen" value="1024"/>

        <!-- Allows wildcard imports -->
        <property key="checkstyle.ignore.imports" value="true"/>

        <!-- Allows test names that start with lowercase -->
        <property key="checkstyle.pattern.type" value="^[a-zA-Z][a-zA-Z0-9_]*$"/>

        <property key="checkstyle.maxmethodlen" value="5000"/>
    </checkstyle>

</target>


<target name="dom2-html-jar" depends="dom2-html-javac">
	<jar jarfile="${build.dir}/dom2-html.jar"  manifest="java/dom2-html.mf">
		<fileset dir="${java.build.dir}"
		         includes="org/w3c/domts/*" excludes="*.bak"/>
		<fileset dir="${java.build.dir}"
		         includes="org/w3c/domts/level2/html/*"
		         excludes="*.bak"/>
		<fileset dir="tests/level2/html/files" excludes="*.bak"/>
		<fileset dir="java"
		         includes="org/w3c/domts/*" excludes="*.bak"/>
	</jar>
</target>


<target name="dom2-html-metadata" depends="dom2-dtd">
    <mkdir dir="${build.dir}"/>
	<style in="${tests.dir}/level2/html/alltests.xml" 
		   out="${build.dir}/dom2-html-metadata.rdf" 
	       style="${transforms.dir}/combine-metadata.xsl">
		<param name="baseURI"
		       expression="http://www.w3.org/2001/DOM-Test-Suite/level2/html/"/>
        <param name="externalMetadata" expression="metadata.xml"/>
	</style>
</target>



<target name="dom2-html-matrix" depends="dom2-html-metadata,dom2-subjects,dom2-interfaces">
    <mkdir dir="${build.dir}"/>
	<style in="${build.dir}/dom2-html-metadata.rdf" 
		   out="${build.dir}/dom2-html-matrix.html" 
	       style="${transforms.dir}/test-matrix.xsl">
		<param name="specURI"
		       expression="http://www.w3.org/TR/DOM-Level-2-HTML/html#"/>
        <param name="interfacesURL" expression="dom2-interfaces.xml"/>
        <param name="specMetadataURL" expression="dom2-html-subjects.xml"/>
        <param name="title" expression='DOM Level 2 HTML Test Suite Matrix'/>
	</style>
</target>


<target name="dom2-html-doxygen" depends="dom2-html-gen-java">
    <mkdir dir="${build.dir}/doxygen/level2"/>

    <!--  doxygen must be on path  
          download from http://www.doxygen.org    -->
    <exec executable="doxygen">
        <arg line="doxygen/dom2-html.doxygen"/>
    </exec>

</target>


<target name="dom2-html-dist" depends="dom2-html-jar,dom2-html-gen-jsunit,dom2-html-matrix,dom2-html-doxygen,junit-run,get-junit-license,dom2-schema">
    <mkdir dir="${build.dir}/level2/html/resources"/>
    <mkdir dir="${build.dir}/level2/html/java"/>
    <copy file="docs/level2/html/index.htm" todir="${build.dir}/level2/html"/>
    <copy todir="${build.dir}/level2/html/resources">
        <fileset dir="docs/level2/html/resources" excludes="*.bak"/>
    </copy>
    <copy file="${build.dir}/dom2-html.jar" todir="${build.dir}/level2/html/java"/>
    <copy file="${build.dir}/junit-run.jar" todir="${build.dir}/level2/html/java"/>
    <copy file="${lib.dir}/junit3.7/junit.jar" todir="${build.dir}/level2/html/java"/>
    <copy file="${lib.dir}/junit-license.html" todir="${build.dir}/level2/html/java"/>
    <copy file="${build.dir}/dom2-html-matrix.html" todir="${build.dir}/level2/html"/>


    <mkdir dir="${build.dir}/level2/html/tests/files"/>
    <copy todir="${build.dir}/level2/html/tests">
        <fileset dir="${tests.dir}/level2/html" includes="*.xml"/>
        <fileset dir="${build.dir}" includes="dom2.dtd"/>
        <fileset dir="${build.dir}" includes="dom2.xsd"/>
        <fileset dir="${transforms.dir}" includes="test-to-html.xsl"/>
    </copy>
    <copy todir="${build.dir}/level2/html/tests/files">
        <fileset dir="${tests.dir}/level2/html/files" excludes="*.bak"/>
    </copy>

    <mkdir dir="${dist.dir}"/>
    <zip  zipfile="${dist.dir}/dom2-html.zip" basedir="${build.dir}/level2/html"/>
    <tar tarfile="${dist.dir}/dom2-html.tar" basedir="${build.dir}/level2/html"/>
    <gzip src="${dist.dir}/dom2-html.tar" zipfile="${dist.dir}/dom2-html.tar.gz"/>
        
        
</target>


<target name="dom2-events-javac" depends="common-javac,dom2-events-gen-java">

	<javac 
		destdir="${java.build.dir}" 
		classpath="${java.build.dir};${jaxp.jar}"
        debug="on"
		encoding="UTF8">
        <src path="${java.build.dir}"/>
        <src path="${specs.dir}/Level-2/Events/java"/>
        <src path="${specs.dir}/Level-2/Views/java"/>
        <include name="org/w3c/domts/*"/>
        <include name="org/w3c/domts/level2/events/*"/>
        <include name="org/w3c/dom/**"/>
    </javac>
</target>

<target name="dom2-events-checkstyle" depends="checkstyle-available, dom2-events-javac">
    <taskdef resource="checkstyletask.properties"/>

    <checkstyle>
        <fileset dir="${java.build.dir}/org/w3c/domts/level2/events" includes="*.java"/>

        <!-- Allow long lines  -->
        <property key="checkstyle.maxlinelen" value="1024"/>

        <!-- Allows wildcard imports -->
        <property key="checkstyle.ignore.imports" value="true"/>

        <!-- Allows test names that start with lowercase -->
        <property key="checkstyle.pattern.type" value="^[a-zA-Z][a-zA-Z0-9_]*$"/>

        <property key="checkstyle.maxmethodlen" value="5000"/>
    </checkstyle>

</target>


<target name="dom2-core-jar" depends="dom2-core-javac">
	<!--  will need to provide a manifest    -->
	<jar jarfile="${build.dir}/dom2-core.jar"  manifest="java/dom2-core.mf">
		<fileset dir="${java.build.dir}"
		         includes="org/w3c/domts/*" excludes="*.bak"/>
		<fileset dir="${java.build.dir}"
		         includes="org/w3c/domts/level2/core/*"
		         excludes="*.bak"/>
		<fileset dir="tests/level2/core/files" excludes="*.bak"/>
		<fileset dir="java"
		         includes="org/w3c/domts/*" excludes="*.bak"/>
	</jar>
</target>

<target name="dom2-events-jar" depends="dom2-events-javac">
	<!--  will need to provide a manifest    -->
	<jar jarfile="${build.dir}/dom2-events.jar"  manifest="java/dom2-events.mf">
		<fileset dir="${java.build.dir}"
		         includes="org/w3c/domts/*" excludes="*.bak"/>
		<fileset dir="${java.build.dir}"
		         includes="org/w3c/domts/level2/events/*"
		         excludes="*.bak"/>
		<fileset dir="tests/level2/events/files" excludes="*.bak"/>
		<fileset dir="java"
		         includes="org/w3c/domts/*" excludes="*.bak"/>
	</jar>
</target>



<target name="dom2-core-doxygen" depends="dom2-core-gen-java">
    <mkdir dir="${build.dir}/doxygen/level2"/>

    <!--  doxygen must be on path  
          download from http://www.doxygen.org    -->
    <exec executable="doxygen">
        <arg line="doxygen/dom2-core.doxygen"/>
    </exec>

</target>

<target name="get-junit-license" depends="init" unless="junit-license-available">
    <get src="http://oss.software.ibm.com/developerworks/opensource/license10.html"
         dest="${lib.dir}/junit-license.html"/>
</target>


<target name="get-junit" depends="init" unless="junit-available">
	<!--  get JUnit 3.7 into lib directory  -->
	<get src="http://download.sourceforge.net/junit/junit3.7.zip"
		dest="${lib.dir}/junit.zip"
        ignoreerrors="yes"
		usetimestamp="yes"/>
</target>

<target name="junit-run" depends="common-javac,get-junit">
	<unzip src="${lib.dir}/junit.zip" dest="${lib.dir}"/>

    <copy file="${lib.dir}/junit3.7/junit.jar" todir="${build.dir}"/>

    <mkdir dir="${java.build.dir}/junit"/>

    <javac srcdir="java/junit/org/w3c/domts"
           destdir="${java.build.dir}/junit"
           classpath="${lib.dir}/junit3.7/junit.jar;${java.build.dir}"           
           debug="on"
		   encoding="UTF8"/>


    <jar jarfile="${build.dir}/junit-run.jar"
        manifest="java/junit/junit-run.mf">
        <fileset dir="${java.build.dir}/junit"
	         includes="org/w3c/domts/**" excludes="*.bak"/>
    </jar>
</target>

<target name="avalon-get" depends="init" unless="avalon-available">
    <!--  Download a nightly build of Avalon testlet source
              No binaries available since project was suspended  -->
	<get src="http://jakarta.apache.org/builds/jakarta-avalon/nightly/2001-10-31/jakarta-avalon-testlet-src.zip"
	     dest="${lib.dir}/avalon.zip"
	     usetimestamp="yes"/>
</target>

<target name="avalon-run" depends="common-javac,avalon-get">
	<!--  get Avalon into lib directory  -->
	<mkdir dir="${java.build.dir}/avalon"/>


    <!--    unzip source   -->
	<unzip src="${lib.dir}/avalon.zip" dest="${lib.dir}"/>

    

    <!--    compile java files   -->
    <ant antfile="build.xml" 
         dir="${lib.dir}/jakarta-avalon-testlet/"         
         target="compile"/>

    <!--   build jar file (done here since task build.xml is not compatible with current Ant) -->
	<jar jarfile="${lib.dir}/testlet.jar">
        <fileset dir="${lib.dir}/jakarta-avalon-testlet/build/classes"
                 includes="org/apache/testlet/**" />
        <zipfileset src="${lib.dir}/jakarta-avalon-testlet/lib/clutil.jar" includes="**/*.class"/>
	</jar>

    <copy file="${lib.dir}/testlet.jar" todir="${build.dir}"/>


	<javac srcdir="java/avalon/org/w3c/domts"
	       destdir="${java.build.dir}/avalon"
	       classpath="${lib.dir}/testlet.jar;${java.build.dir}"	       
           debug="on"
		   encoding="UTF8"/>

	<jar jarfile="${build.dir}/avalon-run.jar"
	     manifest="java/avalon/avalon-run.mf">
		<fileset dir="${java.build.dir}/avalon"
		         includes="org/w3c/domts/*" excludes="*.bak"/>
	</jar>
</target>

<target name="dom2-core-metadata" depends="dom2-dtd">
    <mkdir dir="${build.dir}"/>
	<style in="${tests.dir}/level2/core/alltests.xml" 
		   out="${build.dir}/dom2-core-metadata.rdf" 
	       style="${transforms.dir}/combine-metadata.xsl">
		<param name="baseURI"
		       expression="http://www.w3.org/2001/DOM-Test-Suite/level2/core/"/>
        <param name="externalMetadata" expression="metadata.xml"/>
	</style>
</target>


<target name="dom2-core-matrix" depends="dom2-core-metadata,dom2-subjects,dom2-interfaces">
    <mkdir dir="${build.dir}"/>
	<style in="${build.dir}/dom2-core-metadata.rdf" 
		   out="${build.dir}/dom2-core-matrix.html" 
	       style="${transforms.dir}/test-matrix.xsl">
		<param name="specURI"
		       expression="http://www.w3.org/TR/DOM-Level-2-Core/core#"/>
        <param name="interfacesURL" expression="dom2-core-interfaces.xml"/>
        <param name="specMetadataURL" expression="dom2-core-subjects.xml"/>
        <param name="title" expression="DOM Level 2 Core Test Suite Matrix"/>
	</style>
</target>


<target name="dom2-core-dist" depends="dom2-core-jar,dom2-core-gen-jsunit,dom2-core-doxygen,junit-run,get-junit-license,dom2-schema,dom2-core-matrix">
    <mkdir dir="${build.dir}/level2/core/resources"/>
    <mkdir dir="${build.dir}/level2/core/java"/>
    <copy file="docs/level2/core/index.htm" todir="${build.dir}/level2/core"/>
    <copy todir="${build.dir}/level2/core/resources">
        <fileset dir="docs/level2/core/resources" excludes="*.bak"/>
    </copy>
    <copy file="${build.dir}/dom2-core.jar" todir="${build.dir}/level2/core/java"/>
    <copy file="${build.dir}/junit-run.jar" todir="${build.dir}/level2/core/java"/>
    <copy file="${lib.dir}/junit3.7/junit.jar" todir="${build.dir}/level2/core/java"/>
    <copy file="${lib.dir}/junit-license.html" todir="${build.dir}/level2/core/java"/>
    <copy file="${build.dir}/ecmascript/jsunit/testRunner.html" todir="${build.dir}/level2/core/ecmascript"/>
    <mkdir dir="${build.dir}/level2/core/ecmascript/app"/>
    <copy todir="${build.dir}/level2/core/ecmascript/app">
        <fileset dir="${build.dir}/ecmascript/jsunit/app" excludes="*.bak"/>
    </copy>
    <mkdir dir="${build.dir}/level2/core/ecmascript/images"/>
    <copy todir="${build.dir}/level2/core/ecmascript/images">
        <fileset dir="${build.dir}/ecmascript/jsunit/images" excludes="*.bak"/>
    </copy>
    <mkdir dir="${build.dir}/level2/core/ecmascript/docs"/>
    <copy todir="${build.dir}/level2/core/ecmascript/docs">
        <fileset dir="${build.dir}/ecmascript/jsunit/docs" excludes="*.bak"/>
    </copy>
    <mkdir dir="${build.dir}/level2/core/ecmascript/jsunit-self-tests"/>
    <copy todir="${build.dir}/level2/core/ecmascript/jsunit-self-tests">
        <fileset dir="${build.dir}/ecmascript/jsunit/tests" excludes="*.bak"/>
    </copy>
    <copy file="${build.dir}/dom2-core-matrix.html" todir="${build.dir}/level2/core"/>


    <mkdir dir="${build.dir}/level2/core/tests/files"/>
    <copy todir="${build.dir}/level2/core/tests">
        <fileset dir="${tests.dir}/level2/core" includes="*.xml"/>
        <fileset dir="${build.dir}" includes="dom2.dtd"/>
        <fileset dir="${build.dir}" includes="dom2.xsd"/>
        <fileset dir="${transforms.dir}" includes="test-to-html.xsl"/>
    </copy>
    <copy todir="${build.dir}/level2/core/tests/files">
        <fileset dir="${tests.dir}/level2/core/files" excludes="*.bak"/>
    </copy>

    <mkdir dir="${dist.dir}"/>
    <zip  zipfile="${dist.dir}/dom2-core.zip" basedir="${build.dir}/level2/core"/>
    <tar tarfile="${dist.dir}/dom2-core.tar" basedir="${build.dir}/level2/core"/>
    <gzip src="${dist.dir}/dom2-core.tar" zipfile="${dist.dir}/dom2-core.tar.gz"/>
        
        
</target>


<target name="dom2-gump" depends="dom2-core-validate-tests, 
                                  dom2-events-validate-tests, 
								  dom2-html-validate-tests,
								  dom2-core-schema-validate-tests, 
                                  dom2-events-schema-validate-tests, 
								  dom2-html-schema-validate-tests,								   
								  dom2-core-jar,
								  dom2-events-jar,
								  dom2-html-jar"/>


<target name="clean" depends="init">
	<delete dir="${build.dir}"/>
    <delete dir="${dist.dir}"/>
    <delete>
    	<fileset dir="tests" includes="**/dom?.dtd **/dom?.xsd **/test-to-html.xsl"/>
    </delete>
</target>

<target name="dom3-available" depends="init">
    <available property="dom3-core-available" file="${specs.dir}/DOM3-Core.zip"/>
    <available property="dom3-ls-available" file="${specs.dir}/DOM3-LS.zip"/>
    <available property="dom3-val-available" file="${specs.dir}/DOM3-Val.zip"/>
    <available property="dom3-xpath-available" file="${specs.dir}/DOM3-XPath.zip"/>
    <available property="dom3-events-available" file="${specs.dir}/DOM3-Events.zip"/>
    <available property="dom3-views-available" file="${specs.dir}/DOM3-Views.zip"/>
</target>

<target name="get-dom3-core" depends="dom3-available"><!-- unless="dom3-core-available" -->
	<!--   download DOM 3 Core spec to specs directory   -->
	<get src="http://www.w3.org/TR/2003/CR-DOM-Level-3-Core-20031107/DOM3-Core.zip"
		dest="${specs.dir}/DOM3-Core.zip"
		usetimestamp="yes"/>
</target>

<target name="get-dom3-ls" depends="dom3-available"><!-- unless="dom3-ls-available" -->
	<get src="http://www.w3.org/TR/2003/CR-DOM-Level-3-LS-20031107/DOM3-LS.zip"
		dest="${specs.dir}/DOM3-LS.zip"
		usetimestamp="yes"/>
</target>

<target name="get-dom3-val" depends="dom3-available"><!-- unless="dom3-val-available"-->
	<get src="http://www.w3.org/TR/2003/CR-DOM-Level-3-Val-20030730/DOM3-Val.zip"
		dest="${specs.dir}/DOM3-Val.zip"
		usetimestamp="yes"/>
</target>


<target name="get-dom3-xpath" depends="dom3-available" unless="dom3-xpath-available">
	<get src="http://www.w3.org/TR/2003/CR-DOM-Level-3-XPath-20030331/DOM3-XPath.zip"
		dest="${specs.dir}/DOM3-XPath.zip"
		usetimestamp="yes"/>
</target>

<target name="get-dom3-events" depends="dom3-available"><!-- unless="dom3-events-available"-->
	<get src="http://www.w3.org/TR/2003/NOTE-DOM-Level-3-Events-20031107/DOM3-Events.zip"
		dest="${specs.dir}/DOM3-Events.zip"
		usetimestamp="yes"/>
</target>


<!--target name="get-dom3-views" depends="dom3-available" unless="dom3-views-available">
	<get src="http://www.w3.org/TR/2000/WD-DOM-Level-3-Views-20001115/DOM3-Views.zip"
		dest="${specs.dir}/DOM3-Views.zip"
		usetimestamp="yes"/>
</target-->

<target name="get-dom3" depends="get-xmlspec-v22-dom-dtd,get-dom3-core,get-dom3-ls,get-dom3-val,get-dom3-xpath,get-dom3-events"><!--,get-dom3-views"-->
</target>


<target name="dom3-init-public" unless="member" depends="init,get-dom3">
	<mkdir dir="${specs.dir}"/>
	<mkdir dir="${specs.dir}/Level-3"/>

	<!--unzip src="${specs.dir}/DOM3-Views.zip"
	       dest="${specs.dir}/Level-3/Views"/-->
	<!--  XML source has unusual ../../whatever paths,
	        must put in several layers deep to prevent writing out
			of build tree   -->
	<!--unzip src="${specs.dir}/Level-3/Views/xml-source.zip"
	       dest="${specs.dir}/Level-3/xml/views"/-->

	<unzip src="${specs.dir}/DOM3-XPath.zip"
	       dest="${specs.dir}/Level-3/XPath"/>


	<unzip src="${specs.dir}/DOM3-Events.zip"
	       dest="${specs.dir}/Level-3/Events"/>


	<unzip src="${specs.dir}/DOM3-Core.zip"
	       dest="${specs.dir}/Level-3/Core"/>

	<unzip src="${specs.dir}/DOM3-LS.zip"
	       dest="${specs.dir}/Level-3/LS"/>


	<unzip src="${specs.dir}/DOM3-Val.zip"
	       dest="${specs.dir}/Level-3/Val"/>

    <replace file="${specs.dir}/Level-3/Val/xml-source.xml"
        token='http://www.w3.org/2002/08/xmlspec-v22-dom.dtd'
            value='../../pubtext/xmlspec-v22-dom.dtd'/>


    <delete dir="${specs.dir}/Level-3/Core/java"/>
	<unzip src="${specs.dir}/Level-3/Core/java-binding.zip"
	       dest="${specs.dir}/Level-3/Core/java"/>

    <delete dir="${specs.dir}/Level-3/Events/java"/>
	<unzip src="${specs.dir}/Level-3/Events/java-binding.zip"
	       dest="${specs.dir}/Level-3/Events/java"/>

    <delete dir="${specs.dir}/Level-3/LS/java"/>
	<unzip src="${specs.dir}/Level-3/LS/java-binding.zip"
	       dest="${specs.dir}/Level-3/LS/java"/>

    <delete dir="${specs.dir}/Level-3/Val/java"/>
	<unzip src="${specs.dir}/Level-3/Val/java-binding.zip"
	       dest="${specs.dir}/Level-3/Val/java"/>


    <delete dir="${specs.dir}/Level-3/XPath/java"/>
	<unzip src="${specs.dir}/Level-3/XPath/java-binding.zip"
	       dest="${specs.dir}/Level-3/XPath/java"/>

    <property name="dom3-core-java-src" location="${specs.dir}/Level-3/Core/java"/>
    <property name="dom3-ls-java-src" location="${specs.dir}/Level-3/LS/java"/>
    <property name="dom3-xpath-java-src" location="${specs.dir}/Level-3/XPath/java"/>
    <property name="dom3-val-java-src" location="${specs.dir}/Level-3/Val/java"/>

</target>

<target name="dom3-init-member" if="member" depends="init">
	<mkdir dir="${specs.dir}/Level-3/member"/>
	<get src="http://www.w3.org/DOM/Group/drafts/level-3-src.zip"
		dest="${specs.dir}/level-3-src.zip"
		username="${member}" password="${password}"
		usetimestamp="yes"/>
	<!--  this operation may fail on JDKs prior to JDK 1.4.2
	        see http://developer.java.sun.com/developer/bugParade/bugs/4635869.html   -->
	<!-- unzip src="${specs.dir}/level-3-src.zip"
	       dest="${specs.dir}/Level-3/member"/ -->
	<exec executable="unzip">
		<arg value="-o"/>
		<arg value="${specs.dir}/level-3-src.zip"/>
		<arg value="-d"/>
		<arg value="${specs.dir}/Level-3/member"/>
	</exec>

    <property name="dom3-core-java-src" location="${specs.dir}/Level-3/member/level-3-src/core/java"/>
    <property name="dom3-ls-java-src" location="${specs.dir}/Level-3/member/level-3-src/ls/java"/>
    <property name="dom3-xpath-java-src" location="${specs.dir}/Level-3/member/level-3-src/xpath/java"/>
	
</target>

<target name="dom3-interfaces-public" unless="member" depends="dom3-init-public,dom2-init">
    <delete file="${build.dir}/dom3-interfaces.xml"/>

	<style in="${specs.dir}/Level-3/Core/xml-source.xml"
	       out="${build.dir}/dom3-interfaces.xml"
	       style="${transforms.dir}/dom3-combine.xsl"/>
	<xmlvalidate file="${build.dir}/dom3-interfaces.xml"
	             lenient="yes" failonerror="yes"
	             classname="org.apache.xerces.parsers.SAXParser"/>
</target>

<target name="dom3-interfaces-member" if="member" depends="init, dom3-init-member, dom2-init">
    <delete file="${build.dir}/dom3-interfaces.xml"/>

	<style in="${specs.dir}/Level-3/member/level-3-src/xml/core/dom-spec.xml"
	       out="${build.dir}/dom3-interfaces.xml"
	       style="${transforms.dir}/dom3-combine-member.xsl"/>
	<xmlvalidate file="${build.dir}/dom3-interfaces.xml"
	             lenient="yes" failonerror="yes"
	             classname="org.apache.xerces.parsers.SAXParser"/>

</target>

<target name="dom3-interfaces" depends="dom3-interfaces-public, dom3-interfaces-member"/>

<target name="dom3-schema" depends="dom3-interfaces">
	<style in="${build.dir}/dom3-interfaces.xml"
	       out="${build.dir}/dom3.xsd"
	       style="${transforms.dir}/dom-to-xsd.xsl">
		<param name="schema-namespace"
		   expression="http://www.w3.org/2001/DOM-Test-Suite/Level-3"/>
	</style>

	<!--  remove leading underscore from _xmlns attribute    -->
    <replace dir="${build.dir}" includes="dom3.xsd">
        <replacefilter token="_xmlns" value="xmlns"/>
        <replacefilter token="xmlns_test" value="xmlns:test"/>
    </replace>
	<copy file="${build.dir}/dom3.xsd" todir="${tests.dir}/level3/ls" overwrite="true"/>
	<copy file="${build.dir}/dom3.xsd" todir="${tests.dir}/level3/xpath" overwrite="true"/>
	<copy file="${build.dir}/dom3.xsd" todir="${tests.dir}/level3/core" overwrite="true"/>
	<copy file="${build.dir}/dom3.xsd" todir="${tests.dir}/level3/validation" overwrite="true"/>
</target>

<target name="dom3-dtd" depends="dom3-interfaces">
	<style in="${build.dir}/dom3-interfaces.xml"
	       out="${build.dir}/dom3.dtd"
	       style="${transforms.dir}/dom-to-dtd.xsl">
		<param name="schema-namespace"
		   expression="http://www.w3.org/2001/DOM-Test-Suite/Level-3"/>
		<param name="schema-location" expression="dom3.xsd"/>
        <param name="additional-types" expression="|LSInputStream|LSOutputStream|LSReader|LSWriter|DOMUserData"/>
	</style>
	<copy file="${build.dir}/dom3.dtd" todir="${tests.dir}/level3/ls" overwrite="true"/>
    <copy file="${transforms.dir}/test-to-html.xsl" todir="${tests.dir}/level3/ls" overwrite="true"/>
	<copy file="${build.dir}/dom3.dtd" todir="${tests.dir}/level3/xpath" overwrite="true"/>
    <copy file="${transforms.dir}/test-to-html.xsl" todir="${tests.dir}/level3/xpath" overwrite="true"/>
	<copy file="${build.dir}/dom3.dtd" todir="${tests.dir}/level3/core" overwrite="true"/>
    <copy file="${transforms.dir}/test-to-html.xsl" todir="${tests.dir}/level3/core" overwrite="true"/>
	<copy file="${build.dir}/dom3.dtd" todir="${tests.dir}/level3/validation" overwrite="true"/>
    <copy file="${transforms.dir}/test-to-html.xsl" todir="${tests.dir}/level3/validation" overwrite="true"/>
</target>

<target name="dom3-ls-validate-tests" depends="dom3-dtd">
	<xmlvalidate lenient="no" failonerror="yes"
	             classname="org.apache.xerces.parsers.SAXParser">
		<fileset dir="${tests.dir}/level3/ls" includes="*.xml"/>  
	</xmlvalidate>
</target>

<target name="dom3-ls-schema-validate-tests" depends="check-schema-support, dom3-dtd, dom3-schema">
    <ant antfile="schemavalidate.ant">
    	<property name="validate.dir" location="${tests.dir}/level3/ls"/>  
    </ant>
</target>

<target name="dom3-xpath-validate-tests" depends="dom3-dtd">
	<xmlvalidate lenient="no" failonerror="yes"
	             classname="org.apache.xerces.parsers.SAXParser">
		<fileset dir="${tests.dir}/level3/xpath" includes="*.xml"/>  
	</xmlvalidate>
</target>

<target name="dom3-xpath-schema-validate-tests" depends="check-schema-support, dom3-dtd, dom3-schema">
    <ant antfile="schemavalidate.ant">
    	<property name="validate.dir" location="${tests.dir}/level3/xpath"/>  
    </ant>
</target>

<target name="dom3-core-validate-tests" depends="dom3-dtd">
	<xmlvalidate lenient="no" failonerror="yes"
	             classname="org.apache.xerces.parsers.SAXParser">
		<fileset dir="${tests.dir}/level3/core" includes="*.xml"/>  
	</xmlvalidate>
</target>

<target name="dom3-core-schema-validate-tests" depends="check-schema-support, dom3-dtd, dom3-schema">
    <ant antfile="schemavalidate.ant">
    	<property name="validate.dir" location="${tests.dir}/level3/core"/>  
    </ant>
</target>


<target name="dom3-val-validate-tests" depends="dom3-dtd">
	<xmlvalidate lenient="no" failonerror="yes"
	             classname="org.apache.xerces.parsers.SAXParser">
		<fileset dir="${tests.dir}/level3/validation" includes="*.xml"/>  
	</xmlvalidate>
</target>


<target name="dom3-val-schema-validate-tests" depends="check-schema-support, dom3-dtd, dom3-schema">
    <ant antfile="schemavalidate.ant">
    	<property name="validate.dir" location="${tests.dir}/level3/validation"/>  
    </ant>
</target>


<target name="dom3-subjects" depends="dom3-init-public">
	<!--  create a DOM 3 version of subjects.xsl  -->
    <copy file="${transforms.dir}/subjects.xsl" tofile="${build.dir}/dom3-subjects.xsl"/>
    <replace dir="${build.dir}" includes="dom3-subjects.xsl">
        <replacefilter token="dom1.dtd" value="dom3.dtd"/>
        <replacefilter token="Level-1" value="Level-3"/>
    </replace>

	<style in="${specs.dir}/Level-3/xml/core/dom-spec.xml"
	       out="${build.dir}/dom3-core-subjects.xml"
	       style="${build.dir}/dom3-subjects.xsl"/>
	<style in="${specs.dir}/Level-3/xml/views/dom-spec.xml"
	       out="${build.dir}/dom3-views-subjects.xml"
	       style="${build.dir}/dom3-subjects.xsl"/>
	<style in="${specs.dir}/Level-3/xml/events/dom-spec.xml"
	       out="${build.dir}/dom3-events-subjects.xml"
	       style="${build.dir}/dom3-subjects.xsl"/>
	<style in="${specs.dir}/Level-3/xml/xpath/dom-spec.xml"
	       out="${build.dir}/dom3-xpath-subjects.xml"
	       style="${build.dir}/dom3-subjects.xsl"/>
	<style in="${specs.dir}/Level-3/xml/ls/dom-spec.xml"
	       out="${build.dir}/dom3-ls-subjects.xml"
	       style="${build.dir}/dom3-subjects.xsl"/>
	<style in="${specs.dir}/Level-3/xml/val/dom-spec.xml"
	       out="${build.dir}/dom3-val-subjects.xml"
	       style="${build.dir}/dom3-subjects.xsl"/>
	<!--  remove DOM 3 version of subjects.xsl  -->
	<delete file="{build.dir}/dom3-subjects.xsl"/>
</target>

<target name="dom3-core-gen-java" depends="dom3-interfaces,dom3-dtd">
    <mkdir dir="${build.dir}/java/org/w3c/domts/level3/core"/>

	<style basedir="${tests.dir}/level3/core" 
		   destdir="${java.build.dir}/org/w3c/domts/level3/core" 
		   includes="*.xml" 
           excludes="metadata.xml"
	       style="${transforms.dir}/test-to-java.xsl" 
	       extension=".java">
		<param name="interfaces-docname"
		       expression="../${build.dir}/dom3-interfaces.xml"/>
		<param name="package"
		       expression="org.w3c.domts.level3.core"/>
		<param name="target-uri-base"
		       expression="http://www.w3.org/2001/DOM-Test-Suite/level3/core/"/>
	</style>
</target>


<target name="dom3-ls-gen-java" depends="dom3-interfaces,dom3-dtd">
    <mkdir dir="${build.dir}/java/org/w3c/domts/level3/ls"/>

	<style basedir="${tests.dir}/level3/ls" 
		   destdir="${java.build.dir}/org/w3c/domts/level3/ls" 
		   includes="*.xml" 
           excludes="metadata.xml"
	       style="${transforms.dir}/test-to-java.xsl" 
	       extension=".java">
		<param name="interfaces-docname"
		       expression="../${build.dir}/dom3-interfaces.xml"/>
		<param name="package"
		       expression="org.w3c.domts.level3.ls"/>
		<param name="target-uri-base"
		       expression="http://www.w3.org/2001/DOM-Test-Suite/level3/ls/"/>
	</style>
</target>

<target name="dom3-xpath-gen-java" depends="dom3-interfaces,dom3-dtd">
    <mkdir dir="${build.dir}/java/org/w3c/domts/level3/xpath"/>

	<style basedir="${tests.dir}/level3/xpath" 
		   destdir="${java.build.dir}/org/w3c/domts/level3/xpath" 
		   includes="*.xml" 
           excludes="metadata.xml"
	       style="${transforms.dir}/test-to-java.xsl" 
	       extension=".java">
		<param name="interfaces-docname"
		       expression="../${build.dir}/dom3-interfaces.xml"/>
		<param name="package"
		       expression="org.w3c.domts.level3.xpath"/>
		<param name="target-uri-base"
		       expression="http://www.w3.org/2001/DOM-Test-Suite/level3/xpath/"/>
	</style>
</target>

<target name="dom3-val-gen-java" depends="dom3-interfaces,dom3-dtd">
    <mkdir dir="${build.dir}/java/org/w3c/domts/level3/validation"/>

	<style basedir="${tests.dir}/level3/validation" 
		   destdir="${java.build.dir}/org/w3c/domts/level3/validation" 
		   includes="*.xml" 
           excludes="metadata.xml"
	       style="${transforms.dir}/test-to-java.xsl" 
	       extension=".java">
		<param name="interfaces-docname"
		       expression="../${build.dir}/dom3-interfaces.xml"/>
		<param name="package"
		       expression="org.w3c.domts.level3.validation"/>
		<param name="target-uri-base"
		       expression="http://www.w3.org/2001/DOM-Test-Suite/level3/validation/"/>
	</style>
</target>

<target name="dom3-core-gen-jsunit" depends="jsunit-get,dom3-interfaces,dom3-dtd">
    <mkdir dir="${build.dir}/ecmascript/level3/core/files"/>
    <copy todir="${build.dir}/ecmascript/level3/core">
      <fileset dir="ecmascript" includes="*.js"/>
    </copy>
    <copy todir="${build.dir}/ecmascript/level3/core/files">
      <fileset dir="tests/level3/core/files" excludes="*.bak"/>
    </copy>
    
    <style basedir="${tests.dir}/level3/core" 
      destdir="${build.dir}/ecmascript/level3/core" 
      includes="*.xml" 
      excludes="metadata.xml"
      style="${transforms.dir}/test-to-jsunit.xsl" 
      extension=".html">
      <param name="interfaces-docname"
	expression="../${build.dir}/dom3-interfaces.xml"/>
      <param name="target-uri-base"
	expression="http://www.w3.org/2001/DOM-Test-Suite/level3/core/"/>
      <param name="testpath" expression="../level3/core/"/>
    </style>
</target>



<target name="dom3-xpath-gen-jsunit" depends="jsunit-get,dom3-interfaces,dom3-dtd">
    <mkdir dir="${build.dir}/ecmascript/level3/xpath/files"/>
    <copy todir="${build.dir}/ecmascript/level3/xpath">
      <fileset dir="ecmascript" includes="*.js"/>
    </copy>
    <copy todir="${build.dir}/ecmascript/level3/xpath/files">
      <fileset dir="tests/level3/xpath/files" excludes="*.bak"/>
    </copy>
    
    <style basedir="${tests.dir}/level3/xpath" 
      destdir="${build.dir}/ecmascript/level3/xpath" 
      includes="*.xml" 
      excludes="metadata.xml"
      style="${transforms.dir}/test-to-jsunit.xsl" 
      extension=".html">
      <param name="interfaces-docname"
	expression="../${build.dir}/dom3-interfaces.xml"/>
      <param name="target-uri-base"
	expression="http://www.w3.org/2001/DOM-Test-Suite/level3/xpath/"/>
      <param name="testpath" expression="../level3/xpath/"/>
    </style>
</target>

<!--  

This target generates Java code for one DOM 3 test
using the last dom3-interfaces.xml file generated

Useful for quick evaluation of test modifications 
but not part of the automated build

Name probably should change since it looks like
it would generate all DOM 3 java code
-->
<target name="dom3-gen-java" depends="init">
 <style basedir="${tests.dir}/level3/${module}"
        destdir="${java.build.dir}/org/w3c/domts/level3/${module}"
        includes="${test}"
        style="${transforms.dir}/test-to-java.xsl"
        extension=".java">
  <param name="interfaces-docname"
       expression="../${build.dir}/dom3-interfaces.xml"/>
  <param name="package"
       expression="org.w3c.domts.level3.${module}"/>
  <param name="target-uri-base"
       expression="http://www.w3.org/2001/DOM-Test-Suite/level3/${module}/"/>
 </style>
</target>

<!--  

This target performs a Java compilation of one DOM 3 test

Useful for quick evaluation of test modifications 
but not part of the automated build

Name probably should change since it looks like
it would compile all DOM 3 java code
-->
<target name="dom3-javac" depends="init">

	<javac
		destdir="${java.build.dir}"
		classpath="${java.build.dir};${jaxp.jar}"
                debug="on"
		encoding="UTF8">
        <src path="${java.build.dir}"/>
        <include name="org/w3c/domts/level3/${module}/*"/>
    </javac>
</target>

<target name="dom3-core-javac" depends="common-javac,dom3-core-gen-java">

	<javac 
		destdir="${java.build.dir}" 
		classpath="${java.build.dir};${jaxp.jar}"
        debug="on"
		encoding="UTF8">
        <src path="${java.build.dir}"/>
        <src path="${dom3-core-java-src}"/>
        <src path="${dom3-ls-java-src}"/>
        <src path="${dom3-xpath-java-src}"/>
        <include name="org/w3c/domts/level3/core/*"/>
        <include name="org/w3c/domts/*"/>
        <include name="org/w3c/dom/**"/>
    </javac>
</target>


<target name="dom3-core-checkstyle" depends="checkstyle-available, dom3-core-javac">
    <taskdef resource="checkstyletask.properties"/>

    <checkstyle>
        <fileset dir="${java.build.dir}/org/w3c/domts/level3/core" includes="*.java"/>

        <!-- Allow long lines  -->
        <property key="checkstyle.maxlinelen" value="1024"/>

        <!-- Allows wildcard imports -->
        <property key="checkstyle.ignore.imports" value="true"/>

        <!-- Allows test names that start with lowercase -->
        <property key="checkstyle.pattern.type" value="^[a-zA-Z][a-zA-Z0-9_]*$"/>

        <property key="checkstyle.maxmethodlen" value="5000"/>
    </checkstyle>

</target>


<target name="dom3-core-jar" depends="dom3-core-javac">
	<!--  will need to provide a manifest    -->
	<jar jarfile="${build.dir}/dom3-core.jar"  manifest="java/dom3-core.mf">
		<fileset dir="${java.build.dir}"
		         includes="org/w3c/domts/*" excludes="*.bak"/>
		<fileset dir="${java.build.dir}"
		         includes="org/w3c/domts/level3/core/*"
		         excludes="*.bak"/>
		<fileset dir="${java.build.dir}"
		         includes="org/w3c/dom/*"
		         excludes="*.bak"/>
		<fileset dir="${java.build.dir}"
		         includes="org/w3c/dom/core/*"
		         excludes="*.bak"/>

        <!--  leave commented until we have some associated files  -->
		<!-- fileset dir="tests/level3/ls/files" excludes="*.bak"/ -->
		<fileset dir="java"
		         includes="org/w3c/domts/*" excludes="*.bak"/>
	</jar>
</target>



<target name="dom3-ls-javac" depends="common-javac,dom3-ls-gen-java">

	<javac 
		destdir="${java.build.dir}" 
		classpath="${java.build.dir};${jaxp.jar}"
        debug="on"
		encoding="UTF8">
        <src path="${java.build.dir}"/>
        <src path="${dom3-core-java-src}"/>
        <src path="${dom3-ls-java-src}"/>
        <src path="${dom3-xpath-java-src}"/>
        <include name="org/w3c/domts/level3/ls/*"/>
        <include name="org/w3c/domts/*"/>
        <include name="org/w3c/dom/**"/>
    </javac>
</target>

<target name="dom3-ls-checkstyle" depends="checkstyle-available, dom3-ls-javac">
    <taskdef resource="checkstyletask.properties"/>

    <checkstyle>
        <fileset dir="${java.build.dir}/org/w3c/domts/level3/ls" includes="*.java"/>

        <!-- Allow long lines  -->
        <property key="checkstyle.maxlinelen" value="1024"/>

        <!-- Allows wildcard imports -->
        <property key="checkstyle.ignore.imports" value="true"/>

        <!-- Allows test names that start with lowercase -->
        <property key="checkstyle.pattern.type" value="^[a-zA-Z][a-zA-Z0-9_]*$"/>

        <property key="checkstyle.maxmethodlen" value="5000"/>
    </checkstyle>

</target>


<target name="dom3-ls-jar" depends="dom3-ls-javac">
	<!--  will need to provide a manifest    -->
	<jar jarfile="${build.dir}/dom3-ls.jar"  manifest="java/dom3-ls.mf">
		<fileset dir="${java.build.dir}"
		         includes="org/w3c/domts/*" excludes="*.bak"/>
		<fileset dir="${java.build.dir}"
		         includes="org/w3c/domts/level3/ls/*"
		         excludes="*.bak"/>
		<fileset dir="${java.build.dir}"
		         includes="org/w3c/dom/*"
		         excludes="*.bak"/>
		<fileset dir="${java.build.dir}"
		         includes="org/w3c/dom/ls/*"
		         excludes="*.bak"/>

        <!--  leave commented until we have some associated files  -->
		<!-- fileset dir="tests/level3/ls/files" excludes="*.bak"/ -->
		<fileset dir="java"
		         includes="org/w3c/domts/*" excludes="*.bak"/>
	</jar>
</target>

<target name="dom3-xpath-javac" depends="common-javac,dom3-xpath-gen-java">

	<javac 
		destdir="${java.build.dir}" 
		classpath="${java.build.dir};${jaxp.jar}"
        debug="on"
		encoding="UTF8">
        <src path="${java.build.dir}"/>
        <src path="${dom3-core-java-src}"/>
        <src path="${dom3-xpath-java-src}"/>
        <include name="org/w3c/domts/level3/xpath/*"/>
        <include name="org/w3c/domts/*"/>
        <include name="org/w3c/dom/**"/>
    </javac>
</target>

<target name="dom3-xpath-checkstyle" depends="checkstyle-available, dom3-xpath-javac">
    <taskdef resource="checkstyletask.properties"/>

    <checkstyle>
        <fileset dir="${java.build.dir}/org/w3c/domts/level3/xpath" includes="*.java"/>

        <!-- Allow long lines  -->
        <property key="checkstyle.maxlinelen" value="1024"/>

        <!-- Allows wildcard imports -->
        <property key="checkstyle.ignore.imports" value="true"/>

        <!-- Allows test names that start with lowercase -->
        <property key="checkstyle.pattern.type" value="^[a-zA-Z][a-zA-Z0-9_]*$"/>

        <property key="checkstyle.maxmethodlen" value="5000"/>
    </checkstyle>

</target>


<target name="dom3-xpath-jar" depends="dom3-xpath-javac">
	<!--  will need to provide a manifest    -->
	<jar jarfile="${build.dir}/dom3-xpath.jar"  manifest="java/dom3-xpath.mf">
		<fileset dir="${java.build.dir}"
		         includes="org/w3c/domts/*" excludes="*.bak"/>
		<fileset dir="${java.build.dir}"
		         includes="org/w3c/domts/level3/xpath/*"
		         excludes="*.bak"/>
		<fileset dir="${java.build.dir}"
		         includes="org/w3c/dom/*"
		         excludes="*.bak"/>
		<fileset dir="${java.build.dir}"
		         includes="org/w3c/dom/xpath/*"
		         excludes="*.bak"/>
		<fileset dir="java"
		         includes="org/w3c/domts/*" excludes="*.bak"/>

		<fileset dir="tests/level3/xpath/files" excludes="*.bak"/>
	</jar>
</target>

<target name="dom3-val-javac" depends="common-javac,dom3-val-gen-java">

	<javac 
		destdir="${java.build.dir}" 
		classpath="${java.build.dir};${jaxp.jar}"
        debug="on"
		encoding="UTF8">
        <src path="${java.build.dir}"/>
        <src path="${dom3-core-java-src}"/>
        <src path="${dom3-val-java-src}"/>
        <include name="org/w3c/domts/level3/validation/*"/>
        <include name="org/w3c/domts/*"/>
        <include name="org/w3c/dom/**"/>
    </javac>
</target>


<target name="dom3-val-checkstyle" depends="checkstyle-available, dom3-val-javac">
    <taskdef resource="checkstyletask.properties"/>

    <checkstyle>
        <fileset dir="${java.build.dir}/org/w3c/domts/level3/validation" includes="*.java"/>

        <!-- Allow long lines  -->
        <property key="checkstyle.maxlinelen" value="1024"/>

        <!-- Allows wildcard imports -->
        <property key="checkstyle.ignore.imports" value="true"/>

        <!-- Allows test names that start with lowercase -->
        <property key="checkstyle.pattern.type" value="^[a-zA-Z][a-zA-Z0-9_]*$"/>

        <property key="checkstyle.maxmethodlen" value="5000"/>
    </checkstyle>

</target>


<target name="dom3-val-jar" depends="dom3-val-javac">
	<jar jarfile="${build.dir}/dom3-val.jar"  manifest="java/dom3-val.mf">
		<fileset dir="${java.build.dir}"
		         includes="org/w3c/domts/*" excludes="*.bak"/>
		<fileset dir="${java.build.dir}"
		         includes="org/w3c/domts/level3/validation/*"
		         excludes="*.bak"/>
		<fileset dir="${java.build.dir}"
		         includes="org/w3c/dom/*"
		         excludes="*.bak"/>
		<fileset dir="${java.build.dir}"
		         includes="org/w3c/dom/validation/*"
		         excludes="*.bak"/>

        <!--   book.xml is missing from CVS -->
		<!-- fileset dir="tests/level3/validation/files" excludes="*.bak"/ -->
		<fileset dir="java"
		         includes="org/w3c/domts/*" excludes="*.bak"/>
	</jar>
</target>




<target name="dom3-xpath-metadata" depends="dom3-schema">
    <mkdir dir="${build.dir}"/>
	<style in="${tests.dir}/level3/xpath/alltests.xml" 
		   out="${build.dir}/dom3-xpath-metadata.rdf" 
	       style="${transforms.dir}/combine-metadata.xsl">
		<param name="baseURI"
		       expression="http://www.w3.org/2001/DOM-Test-Suite/level3/xpath/"/>
        <param name="externalMetadata" expression="metadata.xml"/>
	</style>
</target>



<target name="dom3-xpath-matrix" depends="dom3-xpath-metadata,dom3-subjects,dom3-interfaces">
    <mkdir dir="${build.dir}"/>
	<style in="${build.dir}/dom3-xpath-metadata.rdf" 
		   out="${build.dir}/dom3-xpath-matrix.html" 
	       style="${transforms.dir}/test-matrix.xsl">
		<param name="specURI"
		       expression="http://www.w3.org/TR/DOM-Level-3-XPath/xpath#"/>
        <param name="interfacesURL" expression="dom3-interfaces.xml"/>
        <param name="specMetadataURL" expression="dom3-xpath-subjects.xml"/>
        <param name="title" expression='DOM Level 3 XPath Test Suite Matrix'/>
	</style>
</target>


<target name="dom3-gump" depends="dom3-core-validate-tests, 
                                  dom3-ls-validate-tests, 
								  dom3-xpath-validate-tests, 
								  dom3-val-validate-tests, 
								  dom3-core-schema-validate-tests, 
                                  dom3-ls-schema-validate-tests, 
								  dom3-xpath-schema-validate-tests, 
								  dom3-val-schema-validate-tests,								  
								  dom3-core-jar,
								  dom3-ls-jar,
								  dom3-xpath-jar,
								  dom3-val-jar"/>


<target name="svg-available" depends="init">
    <available property="svg-available" file="${specs.dir}/SVG.zip"/>
</target>

<target name="get-svg" depends="svg-available" unless="svg-available">
	<mkdir dir="${specs.dir}/SVG1.0"/>
	<!--   download SVG 1.0 Recommendation to specs directory   -->
	<get src="http://www.w3.org/TR/2001/REC-SVG-20010904/REC-SVG-20010904.zip"
		dest="${specs.dir}/SVG.zip"
		usetimestamp="yes"/>
</target>

<target name="svg-init" depends="get-svg">
	<mkdir dir="${specs.dir}"/>
	<mkdir dir="${specs.dir}/SVG1.0"/>


	<unzip src="${specs.dir}/SVG.zip" dest="${specs.dir}/SVG1.0"/>

	<exec executable="sed" output="${specs.dir}/SVG1.0/coords.xml">
		<arg line="-f patches/svgfix.sed ${specs.dir}/SVG1.0/coords.html"/>
	</exec>
	<xmlvalidate file="${specs.dir}/SVG1.0/coords.xml"
	             lenient="yes" failonerror="yes"
	             classname="org.apache.xerces.parsers.SAXParser"/>

	<exec executable="sed" output="${specs.dir}/SVG1.0/animate.xml">
		<arg line="-f patches/svgfix.sed ${specs.dir}/SVG1.0/animate.html"/>
	</exec>
	<xmlvalidate file="${specs.dir}/SVG1.0/animate.xml"
	             lenient="yes" failonerror="yes"
	             classname="org.apache.xerces.parsers.SAXParser"/>

	<exec executable="sed" output="${specs.dir}/SVG1.0/color.xml">
		<arg line="-f patches/svgfix.sed ${specs.dir}/SVG1.0/color.html"/>
	</exec>
	<xmlvalidate file="${specs.dir}/SVG1.0/color.xml"
	             lenient="yes" failonerror="yes"
	             classname="org.apache.xerces.parsers.SAXParser"/>

	<exec executable="sed" output="${specs.dir}/SVG1.0/extend.xml">
		<arg line="-f patches/svgfix.sed ${specs.dir}/SVG1.0/extend.html"/>
	</exec>
	<xmlvalidate file="${specs.dir}/SVG1.0/extend.xml"
	             lenient="yes" failonerror="yes"
	             classname="org.apache.xerces.parsers.SAXParser"/>


	<exec executable="sed" output="${specs.dir}/SVG1.0/interact.xml">
		<arg line="-f patches/svgfix.sed ${specs.dir}/SVG1.0/interact.html"/>
	</exec>
	<xmlvalidate file="${specs.dir}/SVG1.0/interact.xml"
	             lenient="yes" failonerror="yes"
	             classname="org.apache.xerces.parsers.SAXParser"/>

	<exec executable="sed" output="${specs.dir}/SVG1.0/linking.xml">
		<arg line="-f patches/svgfix.sed ${specs.dir}/SVG1.0/linking.html"/>
	</exec>
	<xmlvalidate file="${specs.dir}/SVG1.0/linking.xml"
	             lenient="yes" failonerror="yes"
	             classname="org.apache.xerces.parsers.SAXParser"/>

	<exec executable="sed" output="${specs.dir}/SVG1.0/masking.xml">
		<arg line="-f patches/svgfix.sed ${specs.dir}/SVG1.0/masking.html"/>
	</exec>
	<xmlvalidate file="${specs.dir}/SVG1.0/masking.xml"
	             lenient="yes" failonerror="yes"
	             classname="org.apache.xerces.parsers.SAXParser"/>

	<exec executable="sed" output="${specs.dir}/SVG1.0/painting.xml">
		<arg line="-f patches/svgfix.sed ${specs.dir}/SVG1.0/painting.html"/>
	</exec>
	<xmlvalidate file="${specs.dir}/SVG1.0/painting.xml"
	             lenient="yes" failonerror="yes"
	             classname="org.apache.xerces.parsers.SAXParser"/>

	<exec executable="sed" output="${specs.dir}/SVG1.0/paths.xml">
		<arg line="-f patches/svgfix.sed ${specs.dir}/SVG1.0/paths.html"/>
	</exec>
	<xmlvalidate file="${specs.dir}/SVG1.0/paths.xml"
	             lenient="yes" failonerror="yes"
	             classname="org.apache.xerces.parsers.SAXParser"/>

	<exec executable="sed" output="${specs.dir}/SVG1.0/pservers.xml">
		<arg line="-f patches/svgfix.sed ${specs.dir}/SVG1.0/pservers.html"/>
	</exec>
	<xmlvalidate file="${specs.dir}/SVG1.0/pservers.xml"
	             lenient="yes" failonerror="yes"
	             classname="org.apache.xerces.parsers.SAXParser"/>

	<exec executable="sed" output="${specs.dir}/SVG1.0/script.xml">
		<arg line="-f patches/svgfix.sed ${specs.dir}/SVG1.0/script.html"/>
	</exec>
	<xmlvalidate file="${specs.dir}/SVG1.0/script.xml"
	             lenient="yes" failonerror="yes"
	             classname="org.apache.xerces.parsers.SAXParser"/>

	<exec executable="sed" output="${specs.dir}/SVG1.0/shapes.xml">
		<arg line="-f patches/svgfix.sed ${specs.dir}/SVG1.0/shapes.html"/>
	</exec>
	<xmlvalidate file="${specs.dir}/SVG1.0/shapes.xml"
	             lenient="yes" failonerror="yes"
	             classname="org.apache.xerces.parsers.SAXParser"/>

	<exec executable="sed" output="${specs.dir}/SVG1.0/struct.xml">
		<arg line="-f patches/svgfix.sed ${specs.dir}/SVG1.0/struct.html"/>
	</exec>
	<xmlvalidate file="${specs.dir}/SVG1.0/struct.xml"
	             lenient="yes" failonerror="yes"
	             classname="org.apache.xerces.parsers.SAXParser"/>

<exec executable="sed" output="${specs.dir}/SVG1.0/types.xml">
		<arg line="-f patches/svgfix.sed ${specs.dir}/SVG1.0/types.html"/>
	</exec>
	<xmlvalidate file="${specs.dir}/SVG1.0/types.xml"
	             lenient="yes" failonerror="yes"
	             classname="org.apache.xerces.parsers.SAXParser"/>


	<exec executable="sed" output="${specs.dir}/SVG1.0/text.xml">
		<arg line="-e'23,5269d' -f patches/svgfix.sed ${specs.dir}/SVG1.0/text.html"/>
	</exec>
	<xmlvalidate file="${specs.dir}/SVG1.0/text.xml"
	             lenient="yes" failonerror="yes"
	             classname="org.apache.xerces.parsers.SAXParser"/>


	<exec executable="sed" output="${specs.dir}/SVG1.0/filters.xml">
		<arg line="-e'24,4785d' -f patches/svgfix.sed ${specs.dir}/SVG1.0/filters.html"/>
	</exec>
	<xmlvalidate file="${specs.dir}/SVG1.0/filters.xml"
	             lenient="yes" failonerror="yes"
	             classname="org.apache.xerces.parsers.SAXParser"/>

	<exec executable="sed" output="${specs.dir}/SVG1.0/styling.xml">
		<arg line="-e'23,1563d' -f patches/svgfix.sed ${specs.dir}/SVG1.0/styling.html"/>
	</exec>
	<xmlvalidate file="${specs.dir}/SVG1.0/styling.xml"
	             lenient="yes" failonerror="yes"
	             classname="org.apache.xerces.parsers.SAXParser"/>

</target>

<target name="svg-interfaces" depends="svg-init,dom2-interfaces">
	<style basedir="${specs.dir}/SVG1.0"
	       in="${specs.dir}/SVG1.0/coords.xml"
	       out="${build.dir}/svg-interfaces.xml"
	       style="${transforms.dir}/svg-to-interface.xsl">
		<param name="dom2-interfaces" expression="../${build.dir}/dom2-interfaces.xml"/>
	</style>
	<xmlvalidate file="${build.dir}/svg-interfaces.xml"
	             lenient="yes" failonerror="yes"
	             classname="org.apache.xerces.parsers.SAXParser"/>
</target>

<target name="svg-schema" depends="svg-interfaces">
	<style in="${build.dir}/svg-interfaces.xml"
	       out="${build.dir}/_svg.xsd"
	       style="${transforms.dir}/dom-to-xsd.xsl">
		<param name="schema-namespace"
		       expression="http://www.w3.org/2001/DOM-Test-Suite/SVG"/>
	</style>

	<!--  remove leading underscore from _xmlns attribute    -->
	<exec executable="sed" output="${build.dir}/svg.xsd">
		<arg line="-e 's/_xmlns/xmlns/g' -e 's/xmlns_test/xmlns:test/g'  ${build.dir}/_svg.xsd"/>
	</exec>
	<delete file="${build.dir}/_svg.xsd"/>
	<xmlvalidate file="${build.dir}/svg.xsd"
	             lenient="yes" failonerror="yes"
	             classname="org.apache.xerces.parsers.SAXParser"/>
</target>

<target name="svg-dtd" depends="svg-interfaces">
	<style in="${build.dir}/svg-interfaces.xml"
	       out="${build.dir}/svg.dtd"
	       style="${transforms.dir}/dom-to-dtd.xsl">
		<param name="schema-namespace"
		       expression="http://www.w3.org/2001/DOM-Test-Suite/SVG"/>
	</style>
	<!-- copy file="${build.dir}/svg.dtd" todir="${tests.dir}/svg"/ -->
</target>


</project> 
